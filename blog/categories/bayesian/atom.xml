<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Bayesian | Statistically Significant]]></title>
  <link href="http://andland.github.io/blog/categories/bayesian/atom.xml" rel="self"/>
  <link href="http://andland.github.io/"/>
  <updated>2014-01-07T19:03:31-05:00</updated>
  <id>http://andland.github.io/</id>
  <author>
    <name><![CDATA[Andrew Landgraf]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Text Decryption Using MCMC]]></title>
    <link href="http://andland.github.io/blog/2013/01/23/text-decryption-using-mcmc/"/>
    <updated>2013-01-23T00:00:00-05:00</updated>
    <id>http://andland.github.io/blog/2013/01/23/text-decryption-using-mcmc</id>
    <content type="html"><![CDATA[<div class='post'>
The famous probabilist and statistician Persi Diaconis wrote an article not too long ago about the "<a href="http://math.uchicago.edu/~shmuel/Network-course-readings/MCMCRev.pdf" target="_blank">Markov chain Monte Carlo (MCMC) Revolution</a>." The paper describes how we are able to solve a diverse set of problems with MCMC. The first example he gives is a text decryption problem solved with a simple Metropolis Hastings sampler.<br /><br />I was always stumped by those <a href="https://en.wikipedia.org/wiki/Cryptogram" target="_blank">cryptograms</a> in the newspaper and thought it would be pretty cool if I could crack them with statistics. So I decided to try it out on my own. The example Diaconis gives is fleshed out in more details by its original authors in its own <a href="http://probability.ca/jeff/ftpdir/decipherart.pdf" target="_blank">article</a>. <br /><br />The decryption I will be attempting is called <a href="https://en.wikipedia.org/wiki/Substitution_cipher" target="_blank">substitution cipher</a>, where each letter of the alphabet corresponds to another letter (possibly the same one). This is the rule that you must follow for the cryptogram game too. There are 26! = 4e26 possible mappings of the letters of the alphabet to one another. This seems like a hopeless problem to solve, but I will show you that a relatively simple solution can be found as long as your reference text is large enough and the text you are trying to decipher is also large enough.<br /><br />The strategy is to use a reference text to create transition probabilities from each letter to the next. This can be stored in a 26 by 26 matrix, where the ith row and jth column is the probability of the jth letter, given the ith letter preceded it. For example, the given the previous letter was a Q, U almost always follows it, so the Q-row and U-column would be close to probability of 1. Assuming these one step transition probabilities are what matter, the likelihood of any mapping is the product of the transition probabilities observed.<br /><br />To create a transition matrix, I downloaded <i>War and Peace </i>from <a href="http://www.gutenberg.org/dirs/2/6/0/2600/2600.txt" target="_blank">Project Gutenberg</a>. I looped through each letter and kept track of the number of number of times each letter followed the previous. I also kept track of a 27th character, which was anything that was not a letter -- for example periods, commas, spaces, etc. This lets me know which letters are more likely to start a word or end a word. Consecutive entries of these special characters are not considered.<br /><br />After I have these counts, I normalize by dividing by the row total. Before normalizing, I add 1 to each cell so that there are no probabilities of 0. This also corresponds to prior information of each transition being equally likely. I could have tried to give more informative prior information (like Q to U being likely), but it would have been difficult and probably inaccurate for the whole matrix.<br /><br />Below is the code for creating the transition probability matrix. Note that I loop through each line and within each line I loop through each character.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">reference=<a href="http://inside-r.org/r-doc/base/readLines"><span style="color: #003399; font-weight: bold;">readLines</span></a><span style="color: #009900;">(</span><span style="color: blue;">"warandpeace.txt"</span><span style="color: #009900;">)</span><br />reference=<a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span>reference<span style="color: #009900;">)</span><br />&nbsp;<br />trans.mat=<a href="http://inside-r.org/r-doc/base/matrix"><span style="color: #003399; font-weight: bold;">matrix</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>=<a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: blue;">""</span><span style="color: #009900;">)</span><br />lastletter=<span style="color: blue;">""</span><br /><span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span>ln <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span>:<a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">(</span>reference<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>ln %% <span style="color: #cc66cc;">1000</span> ==<span style="color: #cc66cc;">0</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><a href="http://inside-r.org/r-doc/base/cat"><span style="color: #003399; font-weight: bold;">cat</span></a><span style="color: #009900;">(</span><span style="color: blue;">"Line"</span><span style="color: #339933;">,</span>ln<span style="color: #339933;">,</span><span style="color: blue;">"<span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #009900;">}</span><br />  <span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span>pos <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span>:<a href="http://inside-r.org/r-doc/base/nchar"><span style="color: #003399; font-weight: bold;">nchar</span></a><span style="color: #009900;">(</span>reference<span style="color: #009900;">[</span>ln<span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    curletter=<a href="http://inside-r.org/r-doc/base/substring"><span style="color: #003399; font-weight: bold;">substring</span></a><span style="color: #009900;">(</span>reference<span style="color: #009900;">[</span>ln<span style="color: #009900;">]</span><span style="color: #339933;">,</span>pos<span style="color: #339933;">,</span>pos<span style="color: #009900;">)</span><br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>curletter %in% <a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />      trans.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><br />                <a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==curletter<span style="color: #009900;">]</span>=<br />        trans.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><br />                  <a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==curletter<span style="color: #009900;">]</span>+<span style="color: #cc66cc;">1</span><br />      lastletter=curletter<br />    <span style="color: #009900;">}</span> <span style="color: black; font-weight: bold;">else</span> <span style="color: #009900;">{</span><br />      <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>lastletter!=<span style="color: blue;">""</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />        trans.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">]</span>=<br />          trans.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">]</span>+<span style="color: #cc66cc;">1</span><br />        lastletter=<span style="color: blue;">""</span><br />      <span style="color: #009900;">}</span><br />    <span style="color: #009900;">}</span><br />  <span style="color: #009900;">}</span><br />  curletter=<span style="color: blue;">""</span><br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>lastletter!=<span style="color: blue;">""</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    trans.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">]</span>=<br />      trans.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">]</span>+<span style="color: #cc66cc;">1</span><br />  <span style="color: #009900;">}</span><br />  lastletter=<span style="color: blue;">""</span><br /><span style="color: #009900;">}</span><br />&nbsp;<br />trans.prob.mat=<a href="http://inside-r.org/r-doc/base/sweep"><span style="color: #003399; font-weight: bold;">sweep</span></a><span style="color: #009900;">(</span>trans.mat+<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/rowSums"><span style="color: #003399; font-weight: bold;">rowSums</span></a><span style="color: #009900;">(</span>trans.mat+<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>FUN=<span style="color: blue;">"/"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><br />I like to visualize my data to make sure everything looks correct. Below is a plot of the transition matrix.&nbsp; The blank space corresponds to non-letter character. A lot of insights can be garnered from this plot. The Q-U relationship pops out. T is the most likely letter to start a word. E is a popular letter to follow many others. Y is likely to end a word.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>melt<span style="color: #009900;">(</span>trans.prob.mat<span style="color: #009900;">)</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>Var2<span style="color: #339933;">,</span>Var1<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+geom_tile<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>fill=value<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  scale_fill_gradient<span style="color: #009900;">(</span>low=<span style="color: blue;">"white"</span><span style="color: #339933;">,</span>high=<span style="color: blue;">"black"</span><span style="color: #339933;">,</span>limits=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Probability of Second Letter"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Conditioning on First Letter"</span><span style="color: #339933;">,</span>fill=<span style="color: blue;">"Prob"</span><span style="color: #009900;">)</span>+<br />  scale_y_discrete<span style="color: #009900;">(</span>limits = <a href="http://inside-r.org/r-doc/base/rev"><span style="color: #003399; font-weight: bold;">rev</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">(</span>melt<span style="color: #009900;">(</span>trans.prob.mat<span style="color: #009900;">)</span>$Var1<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  coord_equal<span style="color: #009900;">(</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-rOSjww2Z0q0/UPlrNU1mO2I/AAAAAAAAHqM/NizWxWZ8K88/s1600/trans.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://lh3.ggpht.com/-rOSjww2Z0q0/UPlrNU1mO2I/AAAAAAAAHqM/NizWxWZ8K88/s1600/trans.jpeg" /></a></div><div class="separator" style="clear: both; text-align: center;"></div><br />The desired solution will be the one that gives the highest likelihood. This is an <a href="https://en.wikipedia.org/wiki/NP-hard" target="_blank">NP-hard</a> problem so the only way to find the solution is to try all 26! combinations of mappings, which is infeasible, and report the one with the highest likelihood.<br /><br />With the MCMC approach you start with a random mapping of letters. Next you propose a new mapping by randomly switching 2 of the characters in the mapping. So if A mapped to G and L mapped to Z and you switched those two, A would map to Z and L would map to G. With this new mapping, you measure the likelihood and divide it by the likelihood of the previous mapping. If this ratio is greater than 1, then move to this new mapping. If the ratio is less than 1, meaning the new mapping is less likely, then move to this new mapping with a probability equal to the ratio. (Practically, this is done by drawing a random uniform number between 0 and 1 and moving to the proposed mapping if the uniform number is less than the ratio.) Repeat this process until you think you have found a solution.<br /><br />To do this, I first wrote a few functions. One to decode the coded text based on the mapping. The other was to calculate the log likelihood of the decoded text.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">decode &lt;- <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>mapping<span style="color: #339933;">,</span>coded<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />  coded=<a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span>coded<span style="color: #009900;">)</span><br />  decoded=coded<br />  <span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span>i <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span>:<a href="http://inside-r.org/r-doc/base/nchar"><span style="color: #003399; font-weight: bold;">nchar</span></a><span style="color: #009900;">(</span>coded<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/substring"><span style="color: #003399; font-weight: bold;">substring</span></a><span style="color: #009900;">(</span>coded<span style="color: #339933;">,</span>i<span style="color: #339933;">,</span>i<span style="color: #009900;">)</span> %in% <a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />      <a href="http://inside-r.org/r-doc/base/substring"><span style="color: #003399; font-weight: bold;">substring</span></a><span style="color: #009900;">(</span>decoded<span style="color: #339933;">,</span>i<span style="color: #339933;">,</span>i<span style="color: #009900;">)</span>=<a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">[</span>mapping==<a href="http://inside-r.org/r-doc/base/substring"><span style="color: #003399; font-weight: bold;">substring</span></a><span style="color: #009900;">(</span>coded<span style="color: #339933;">,</span>i<span style="color: #339933;">,</span>i<span style="color: #009900;">)</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />    <span style="color: #009900;">}</span><br />  <span style="color: #009900;">}</span><br />  decoded<br /><span style="color: #009900;">}</span><br />&nbsp;<br />&nbsp;<br />log.prob &lt;- <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>mapping<span style="color: #339933;">,</span>decoded<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />  logprob=<span style="color: #cc66cc;">0</span><br />&nbsp;<br />  lastletter=<span style="color: blue;">""</span><br />  <span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span>i <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span>:<a href="http://inside-r.org/r-doc/base/nchar"><span style="color: #003399; font-weight: bold;">nchar</span></a><span style="color: #009900;">(</span>decoded<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    curletter=<a href="http://inside-r.org/r-doc/base/substring"><span style="color: #003399; font-weight: bold;">substring</span></a><span style="color: #009900;">(</span>decoded<span style="color: #339933;">,</span>i<span style="color: #339933;">,</span>i<span style="color: #009900;">)</span><br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>curletter %in% <a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />      logprob=logprob+<a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">(</span>trans.prob.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><br />                                         <a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==curletter<span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />      lastletter=curletter<br />    <span style="color: #009900;">}</span> <span style="color: black; font-weight: bold;">else</span> <span style="color: #009900;">{</span><br />      <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>lastletter!=<span style="color: blue;">""</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />        logprob=logprob+<a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">(</span>trans.prob.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />        lastletter=<span style="color: blue;">""</span><br />      <span style="color: #009900;">}</span><br />    <span style="color: #009900;">}</span><br />  <span style="color: #009900;">}</span><br />&nbsp;<br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>lastletter!=<span style="color: blue;">""</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    logprob=logprob+<a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">(</span>trans.prob.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />    lastletter=<span style="color: blue;">""</span><br />  <span style="color: #009900;">}</span><br />  logprob<br /><span style="color: #009900;">}</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br />To show how this works, I will use the same Shakespeare text that is used in the MCMC Revolution paper. I let it run until it tries out 2000 different mappings (not the same as 2000 iterations, because rejected proposals are not counted). Along the way I am keeping track of the most likely mapping visited, and that will be the final estimate. It should be noted that I am only considering the mapping of letters and it is assumed that the special characters are known. For example spaces and periods are assumed to be the same.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">correctTxt=<span style="color: blue;">"ENTER HAMLET HAM TO BE OR NOT TO BE THAT IS THE QUESTION WHETHER TIS NOBLER IN THE MIND TO SUFFER THE SLINGS AND ARROWS OF OUTRAGEOUS FORTUNE OR TO TAKE ARMS AGAINST A SEA OF TROUBLES AND BY OPPOSING END"</span><br />coded=decode<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/sample"><span style="color: #003399; font-weight: bold;">sample</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>correctTxt<span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># randomly scramble the text</span><br />&nbsp;<br />mapping=<a href="http://inside-r.org/r-doc/base/sample"><span style="color: #003399; font-weight: bold;">sample</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># initialize a random mapping</span><br />i=<span style="color: #cc66cc;">1</span><br />iters=<span style="color: #cc66cc;">2000</span><br />cur.decode=decode<span style="color: #009900;">(</span>mapping<span style="color: #339933;">,</span>coded<span style="color: #009900;">)</span><br />cur.loglike=log.prob<span style="color: #009900;">(</span>mapping<span style="color: #339933;">,</span>cur.decode<span style="color: #009900;">)</span><br />max.loglike=cur.loglike<br />max.decode=cur.decode<br /><span style="color: black; font-weight: bold;">while</span> <span style="color: #009900;">(</span>i&lt;=iters<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />  proposal=<a href="http://inside-r.org/r-doc/base/sample"><span style="color: #003399; font-weight: bold;">sample</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">26</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># select 2 letters to switch</span><br />  prop.mapping=mapping<br />  prop.mapping<span style="color: #009900;">[</span>proposal<span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span>=mapping<span style="color: #009900;">[</span>proposal<span style="color: #009900;">[</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span><br />  prop.mapping<span style="color: #009900;">[</span>proposal<span style="color: #009900;">[</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span>=mapping<span style="color: #009900;">[</span>proposal<span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span><br />&nbsp;<br />  prop.decode=decode<span style="color: #009900;">(</span>prop.mapping<span style="color: #339933;">,</span>coded<span style="color: #009900;">)</span><br />  prop.loglike=log.prob<span style="color: #009900;">(</span>prop.mapping<span style="color: #339933;">,</span>prop.decode<span style="color: #009900;">)</span><br />&nbsp;<br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/runif"><span style="color: #003399; font-weight: bold;">runif</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>&lt;exp<span style="color: #009900;">(</span>prop.loglike-cur.loglike<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    mapping=prop.mapping<br />    cur.decode=prop.decode<br />    cur.loglike=prop.loglike<br />&nbsp;<br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>cur.loglike&gt;max.loglike<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />      max.loglike=cur.loglike<br />      max.decode=cur.decode<br />    <span style="color: #009900;">}</span><br />&nbsp;<br />    <a href="http://inside-r.org/r-doc/base/cat"><span style="color: #003399; font-weight: bold;">cat</span></a><span style="color: #009900;">(</span>i<span style="color: #339933;">,</span>cur.decode<span style="color: #339933;">,</span><span style="color: blue;">"<span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><br />    i=i+<span style="color: #cc66cc;">1</span><br />  <span style="color: #009900;">}</span><br /><span style="color: #009900;">}</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><br />The output of this example is below. You can see that it comes close but it doesn't quite find the correct mapping. I attribute this to the fact that the text I was trying to decode only had 203 characters. In the paper mentioned above, they decoded the whole play. They further say that their methods work just as well if you randomly sample a text snippet 2000 characters long. Obviously my example had well less than this. This is also a problem in trying to solve a cryptogram because those are even smaller than the Hamlet example I used. So unfortunately this simple method cannot be used for that. (Note that I ran the MCMC chain a several times, using different random starting points, until it came reasonably close to the solution. This is something that the authors also suggested doing.)<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-DABUm0zHOa4/UPmFEVqbsWI/AAAAAAAAHqc/UgIi3nx4VTk/s1600/Iters.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://lh3.ggpht.com/-DABUm0zHOa4/UPmFEVqbsWI/AAAAAAAAHqc/UgIi3nx4VTk/s1600/Iters.png" /></a></div><br /><br />I want to also note that I originally used Alice and Wonderland as the reference text. It had more trouble decoding since this book is much smaller than War and Peace, and therefore the transition probabilities were not as good.<br /><br />The MCMC method is a greedy approach in that you are moving to any mapping that increases the likelihood. Greedy methods are not optimal in general because they can get stuck at local modes, especially in high dimensional problems. MCMC avoids this be moving to less likely mappings with some probability, which ensures that it will find the correct solution with enough time.</div>


<h2>Comments</h2>


<div class='comments'>
<div class='comment'>
<div class='author'>Vivek</div>
<div class='content'>
Andrew,<br /><br />This work is cool!<br /><br />I wrote my own substitution cipher decoder using the algorithm described in Stephen Connor&#39;s dissertation as the basis, but I occasionally glanced at your work as well.<br /><br />My code doesn&#39;t work as awesomely as yours, and it is also much slower (possibly because I use 76 versus the 27 characters, reachChar versus readLine), and I use different functions.<br /><br />But I cited your work and copied your idea for the melt matrix, which is ingenious.<br /><br />Thanks so much!<br /><br />Vivek</div>
</div>
<div class='comment'>
<div class='author'>Andrew Landgraf</div>
<div class='content'>
Thanks, Fernando. I knew I could speed it up by treating it as a vector of letters (or integers), but didn&#39;t take the time to figure it out.</div>
</div>
<div class='comment'>
<div class='author'>Fernando</div>
<div class='content'>
Nice work, but the code to get the transition matrix is VERY slow. I manage to make it faster doing the following:<br />1- get the vector of words (using scan() for example).<br />2- For each word, use strsplit(word, NULL)[[1]] and iterate<br />over the characters to populate the matrix.</div>
</div>
<div class='comment'>
<div class='author'>Andrew</div>
<div class='content'>
I have had that issue working on different computers. I think older versions of reshape2 use X# and newer versions use Var#. Or maybe it&#39;s a difference between using the package reshape and reshape2?</div>
</div>
<div class='comment'>
<div class='author'>Pablik</div>
<div class='content'>
Great work! Sometimes I use Persi&#39;s example for teaching MCMC,<br />there are some old matlab code from the original consultancy work,<br />but I never tryed to replicate the example.<br /><br />I got an error at:<br />ggplot(melt(trans.prob.mat),aes(Var2,Var1))+...<br /><br />the melt() function uses X1 and X2:<br />&gt; tmp &lt;- melt(trans.prob.mat)<br />&gt; head(tmp)<br />  X1 X2        value<br />1  A  A 3.893588e-05<br />2  B  A 9.252956e-02<br />...<br />Cheers,<br /><br />Pablo<br /></div>
</div>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[What's Up with Albert Pujols?]]></title>
    <link href="http://andland.github.io/blog/2012/05/05/whats-up-with-alber-pujols/"/>
    <updated>2012-05-05T00:00:00-04:00</updated>
    <id>http://andland.github.io/blog/2012/05/05/whats-up-with-alber-pujols</id>
    <content type="html"><![CDATA[<div class='post'>
After signing a huge deal with the Angels, Pujols has been having a really bad year. He hasn't hit a home run this year, breaking a career long streak. So I thought it would be a good idea to use some statistics to tell how good or bad we think Pujols will actually be this year.<br /><br />Coming into the year, he had a career .328/.420/.617 career AVG/OBP/SLG. Through one month, he has a .194/.237/.269. So what do we expect out of Pujols for the rest of the year?<br /><br />In Bayesian statistical terms, we can quantify our prior beliefs about Pujols from his history before this year. Below are histograms and fitted distributions of Pujols' yearly batting lines from 2001 to 2011. His numbers are well above normal and he has been the best player in baseball for a while.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-eBkY_jm8kn0/T6WDvtfUlZI/AAAAAAAAGss/dNE4TkjFC6I/s1600/pujols.bmp" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-eBkY_jm8kn0/T6WDvtfUlZI/AAAAAAAAGss/dNE4TkjFC6I/s1600/pujols.bmp" /></a></div>So coming into this year, we would expect him to have a batting average between .290 and .370, with .330 being the most likely, for example.<br /><br />Combining our prior expectations with the data we have observed from this year, we can get our posterior beliefs. When we do that, we get a posterior expectation that Pujols is a true .312/.379/.451 hitter. The league averages from 2001 to 2011 are .263/.331/.418, so he is still expected to be well above the average player, even with the poor start. If we use data from just this year, we do not have enough data to give us an accurate reflection of how good he is. If we combine the data with our prior beliefs, we get a better indication of what to expect. Below is a table that compares these numbers.<br /><br /><style type="text/css">.nobrtable br { display: none } </style><br /><div class="nobrtable"><table border="2" bordercolor="#3366cc" cellpadding="3" cellspacing="3" style="background-color: white;"><tbody><tr style="background-color: #3366cc; color: white; padding-bottom: 4px; padding-top: 5px;"> <th><br /></th><th>AVG</th><th>OBP</th><th>SLG</th></tr><tr><td>League</td><td>.263</td><td>.331</td><td>.418</td></tr><tr><td>Prior</td><td>.328</td><td>.420</td><td>.617</td></tr><tr><td>This Year</td><td>.194</td><td>.237</td><td>.269</td></tr><tr><td>Posterior</td><td>.312</td><td>.379</td><td>.451</td></tr></tbody></table></div><br />Finally, we can also get the whole posterior distribution (not just the expectation). I have plotted the prior and posterior distributions on the same graph. You can see that Pujols' bad month has caused our beliefs about him to decrease quite a bit. Most notable is the slugging percentage, which is likely because of his career-long homerless streak.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-ZmO18a8vj0w/T6WLW6LnjsI/AAAAAAAAGs4/ll2ab7sGJAg/s1600/pujols-prior+and+posterior.bmp" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-ZmO18a8vj0w/T6WLW6LnjsI/AAAAAAAAGs4/ll2ab7sGJAg/s1600/pujols-prior+and+posterior.bmp" /></a></div><br />What Bayesian analysis does is shrinks (or regresses) the data from this year to the prior average. This is&nbsp; the same idea of regressing to the overall mean that is talked about frequently in sabermetric blogs. The difference is that regressing to the mean usually regresses to the average player in the league. With Bayesian analysis, we can regress to our prior expectation about the specific player (Albert Pujols). I believe this approach will give us better results in most cases.<br /><br />The R code to do the analysis can be found <a href="https://docs.google.com/open?id=0B21DLJKq18K9NkNJb0lQRHNqbHM">here</a>. I used data from <a href="http://www.baseball-reference.com/players/p/pujolal01.shtml">Baseball Reference</a>.</div>


<h2>Comments</h2>


<div class='comments'>
<div class='comment'>
<div class='author'>Andrew Landgraf</div>
<div class='content'>
Just a follow up: From May 6 to the end of the season he had a .305/.365/.569 split. The posterior expectation of .312/.379/.451 matches the average and on base percentage well, but his actual slugging is quite a bit higher than the posterior distribution would have predicted.<br /><br />Not sure what to make of this except to say he had a really bad start with slugging, which may have been caused more by random chance than the other two. And obviously the distributional assumptions are an approximation to reality.</div>
</div>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Empirical Bayes Estimation of On Base Percentage]]></title>
    <link href="http://andland.github.io/blog/2010/12/31/empirical-bayes-estimation-of-on-base/"/>
    <updated>2010-12-31T00:00:00-05:00</updated>
    <id>http://andland.github.io/blog/2010/12/31/empirical-bayes-estimation-of-on-base</id>
    <content type="html"><![CDATA[<div class='post'>
I guess you could call this On Bayes Percentage. *cough*<br /><br />Fresh off learning Bayesian techniques in one of my classes last quarter, I thought it would be fun to try to apply the method. I was able to find some examples of <a href="http://en.wikipedia.org/wiki/Hierarchical_Bayes_model">Hierarchical Bayes </a>being used to analyze baseball data at <a href="http://www-stat.wharton.upenn.edu/%7Estjensen/">Wharton</a>. <br /><br /><b>Setting up the problem</b><br />On base percentage (OBP) is probably the most important basic offensive statistic in baseball. Getting a reliable estimate of a players true ability to get on base is therefore important. The basic problem is that the sample size we get from one season rarely has enough observations so that we are certain of a player's ability. Even though there are 162 games in a season, there is a possibility that the actual OBP is the result of luck rather than skill. Bayesian analysis will "regress" the actual observed OBP to the mean, in that if a player has a small number of plate appearances (PA) it doesn't give them very much weight and the result will be something closer to the overall (MLB) average. On the other hand, if a player has quite a few PAs then it believes that the results are not the result of luck and it gives the observations a lot of weight.<br />We are trying to estimate the "true" OBP of each batter. Bayesian analysis assumes that the true OBP is random. <a href="http://en.wikipedia.org/wiki/Empirical_Bayes_method">Empirical Bayes</a> is a method of figuring out the distribution of "true" OBP using the data. OBP is times on base divided by PA. Times on base (X) for each batter is distributed <a href="http://en.wikipedia.org/wiki/Binomial_distribution">binomial</a> with n=PA and p=true OBP. We further assume that p is distributed <a href="http://en.wikipedia.org/wiki/Beta_distribution">Beta</a> with parameters a and b. It follows from this that the marginal distribution of X is distributed according to the distribution:<br />gamma(a+b)*gamma(a+x)*gamma(n-x+b)*(n choose x)/(gamma(a)*gamma(b)*gamma(a+b+n))<br />where gamma is the <a href="http://en.wikipedia.org/wiki/Gamma_function">gamma function</a>.<br />We will estimate the parameters a and b based on the data (X), using its marginal distribution (the "empirical" part of Bayes). To do this I found that likelihood of the marginal distribution of all the batters. Then I maximized this likelihood by adjusting the parameters a and b. This is called the ML-II.<br /><br /><b>The Analysis</b><br />I used data for all non-pitchers in 2010. I assume that each player is independent. In doing that, I just have to multiply all the marginals for each player together to get the likelihood. When I do this and maximize it with respect to a and b, I get estimates that a = 83.48291 and b = 174.9038. I think this can be interpreted that prior mean (what we would assume that average OBP of a batter is before seeing him bat) is a/(a+b) = 0.323. This is pretty close to what the overall OBP of the league was (0.330). I think it makes sense that the prior is lower than the league average because batters who do well will get more opportunities and players that do poorly will get fewer. So the league average is biased high. <br />Below is a graph of the prior distribution and the updated posteriors of every batter. You can (sort of) see that the posteriors have tighter distributions than the prior does. (The posterior distribution of each batter in this case is the distribution of OBP after we have observed PA and the actual OBP.)<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/_qD9db1gpElc/TR1lbFd8yfI/AAAAAAAAFhQ/IkoRr-9FrZw/s1600/dist.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/_qD9db1gpElc/TR1lbFd8yfI/AAAAAAAAFhQ/IkoRr-9FrZw/s1600/dist.jpg" /></a></div><br /><br />One way to see why this Bayesian analysis is useful is to compare the posterior means with the observed OBP. If someone has only a few PAs, their OBP could be very high or very low and this may mislead you into thinking that this batter is very good or bad. However, the posterior mean takes into account the number of PAs. Below is a graph comparing the two. You can see that the range of values for posterior mean is pretty small, especially compare to actual OBP.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/_qD9db1gpElc/TR1mzX6IK2I/AAAAAAAAFhU/hlrgx0oDK38/s1600/OBPvsPostMean.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/_qD9db1gpElc/TR1mzX6IK2I/AAAAAAAAFhU/hlrgx0oDK38/s1600/OBPvsPostMean.jpg" /></a></div><br />Here is a list of the highest posterior mean OBP:<br /><br /><table border="0" cellpadding="0" cellspacing="0" style="width: 252px;"><colgroup><col style="width: 87pt;" width="116"></col>  <col style="width: 54pt;" width="72"></col>  <col style="width: 48pt;" width="64"></col>  </colgroup><tbody><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="height: 15pt; width: 87pt;" width="116"><b>Batter</b></td>   <td class="xl65" style="border-left: medium none; width: 54pt;" width="72"><b>Posterior Mean</b></td>   <td class="xl65" style="border-left: medium none; width: 48pt;" width="64"><b>Actual OBP</b></td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Joey Votto</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.396</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.424</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Miguel Cabrera</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.392</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.420</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Albert Pujols</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.390</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.414</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Justin Morneau</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.388</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.437</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Josh Hamilton</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.383</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.411</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Prince Fielder</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.380</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.401</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Shin-Soo Choo</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.379</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.401</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Kevin Youkilis</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.379</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.412</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Joe Mauer</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.378</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.402</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Adrian   Gonzalez</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.374</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.393</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Daric Barton</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.374</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.393</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Jim Thome</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.373</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.412</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Paul Konerko</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.373</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.393</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Jason Heyward</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.373</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.393</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Matt Holliday</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.371</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.390</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Carlos Ruiz</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.371</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.400</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Manny Ramirez</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.371</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.409</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Billy Butler</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.370</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.388</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Jayson Werth</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.370</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.388</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl65" height="20" style="border-top: medium none; height: 15pt;">Ryan Zimmerman</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.369</td>   <td align="right" class="xl66" style="border-left: medium none; border-top: medium none;">0.388</td>  </tr></tbody></table><br />And here is a list of the lowest posterior mean OBP:<br /><br /><table border="0" cellpadding="0" cellspacing="0" style="width: 245px;"><colgroup><col style="width: 98pt;" width="131"></col>  <col style="width: 29pt;" width="39"></col>  <col style="width: 56pt;" width="75"></col>  </colgroup><tbody><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="height: 15pt; width: 98pt;" width="131"><b>Batter</b></td>   <td class="xl66" style="border-left: medium none; width: 29pt;" width="39"><b>Posterior Mean</b></td>   <td class="xl66" style="border-left: medium none; width: 56pt;" width="75"><b>Actual OBP</b></td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Brandon Wood</td>   <td align="right" class="xl65">0.252</td>   <td align="right" class="xl67" style="border-top: medium none;">0.175</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Pedro Feliz</td>   <td align="right" class="xl65">0.271</td>   <td align="right" class="xl67" style="border-top: medium none;">0.240</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Jeff Mathis</td>   <td align="right" class="xl65">0.276</td>   <td align="right" class="xl67" style="border-top: medium none;">0.219</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Garret   Anderson</td>   <td align="right" class="xl65">0.277</td>   <td align="right" class="xl67" style="border-top: medium none;">0.204</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Adam Moore</td>   <td align="right" class="xl65">0.281</td>   <td align="right" class="xl67" style="border-top: medium none;">0.230</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Josh Bell</td>   <td align="right" class="xl65">0.285</td>   <td align="right" class="xl67" style="border-top: medium none;">0.224</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Jose Lopez</td>   <td align="right" class="xl65">0.286</td>   <td align="right" class="xl67" style="border-top: medium none;">0.270</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Peter Bourjos</td>   <td align="right" class="xl65">0.287</td>   <td align="right" class="xl67" style="border-top: medium none;">0.237</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Aaron Hill</td>   <td align="right" class="xl65">0.287</td>   <td align="right" class="xl67" style="border-top: medium none;">0.271</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Tony Abreu</td>   <td align="right" class="xl65">0.288</td>   <td align="right" class="xl67" style="border-top: medium none;">0.244</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Koyie Hill</td>   <td align="right" class="xl65">0.291</td>   <td align="right" class="xl67" style="border-top: medium none;">0.254</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Gerald Laird</td>   <td align="right" class="xl65">0.291</td>   <td align="right" class="xl67" style="border-top: medium none;">0.263</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Drew Butera</td>   <td align="right" class="xl65">0.291</td>   <td align="right" class="xl67" style="border-top: medium none;">0.237</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Jeff Clement</td>   <td align="right" class="xl65">0.291</td>   <td align="right" class="xl67" style="border-top: medium none;">0.237</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Matt Carson</td>   <td align="right" class="xl65">0.291</td>   <td align="right" class="xl67" style="border-top: medium none;">0.193</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Humberto   Quintero</td>   <td align="right" class="xl65">0.292</td>   <td align="right" class="xl67" style="border-top: medium none;">0.262</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Wil Nieves</td>   <td align="right" class="xl65">0.292</td>   <td align="right" class="xl67" style="border-top: medium none;">0.244</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Matt   Tuiasosopo</td>   <td align="right" class="xl65">0.292</td>   <td align="right" class="xl67" style="border-top: medium none;">0.234</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Luis Montanez</td>   <td align="right" class="xl65">0.292</td>   <td align="right" class="xl67" style="border-top: medium none;">0.155</td>  </tr><tr height="20" style="height: 15pt;">   <td class="xl66" height="20" style="border-top: medium none; height: 15pt;">Cesar Izturis</td>   <td align="right" class="xl65">0.292</td>   <td align="right" class="xl67" style="border-top: medium none;">0.277</td>  </tr></tbody></table><br />You can see that all of the posterior means are pulled closer to the overall mean (the good players look worse and the bad players look better). The order changes a little bit but not too much. <br /><br />You can see the effect of sample size (PAs) by comparing Justin Morneau with Joey Votto. Morneau had a higher OBP, but Votto ended up with a higher posterior mean because he had more PAs (Votto had 648 while Morneau had 348). Here are their posterior distributions:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/_qD9db1gpElc/TR1tYF814sI/AAAAAAAAFhY/4-gKxwH1JgY/s1600/distcompare.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/_qD9db1gpElc/TR1tYF814sI/AAAAAAAAFhY/4-gKxwH1JgY/s1600/distcompare.jpg" /></a></div><br /><br />Because of the additional PAs, you can see that the distribution of Votto is a little tighter than Morneau. We are more sure that Votto is excellent than we are sure that Morneau is excellent.</div>

]]></content>
  </entry>
  
</feed>
