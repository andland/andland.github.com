<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: R | Statistically Significant]]></title>
  <link href="http://andland.github.io/blog/categories/r/atom.xml" rel="self"/>
  <link href="http://andland.github.io/"/>
  <updated>2014-05-04T12:03:57-04:00</updated>
  <id>http://andland.github.io/</id>
  <author>
    <name><![CDATA[Andrew Landgraf]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Yet Another Baseball Defense Statistic]]></title>
    <link href="http://andland.github.io/blog/2014/04/22/yet-another-baseball-defensive-statistic/"/>
    <updated>2014-04-22T22:00:00-04:00</updated>
    <id>http://andland.github.io/blog/2014/04/22/yet-another-baseball-defensive-statistic</id>
    <content type="html"><![CDATA[<p><a href="http://www.fangraphs.com">Fangraphs</a> recently published an interesting dataset that measures defensive efficiency of fielders. For each player, the <a href="http://www.fangraphs.com/blogs/inside-edge-fielding-data/">Inside Edge</a> dataset breaks their opportunities to make plays into five categories, ranging from almost impossible to routine. It also records the proportion of times that the player successfully made the play. With this data, we can see how successful each player is for each type of play. I wanted to think of a way to combine these five proportions into one fielding metric. From here on, I will assume that there is no error in categorizing a play as easy or hard and that there is no bias in the categorizations.</p>

<h3 id="model">Model</h3>

<p>The model I will build is motivated by <a href="http://en.wikipedia.org/wiki/Ordered_logit">ordinal regression</a>. If we only were concerned with the success rate in one of the categories, we could use standard logistic regression, and the probability that player $i$ successfully made a play would be assumed to be $\sigma(\theta_i)$, where $\sigma()$ is the <a href="https://en.wikipedia.org/wiki/Logistic_function">logistic function</a>. Using our prior knowledge that plays categorized as easy should have a higher success rate than plays categorized as difficult, I would like to generalize this. </p>

<p>Say there are only two categories: easy and hard. We could model the probability that player $i$ successfully made an hard play as $\sigma(\theta_i)$ and the probability that he made an easy play as $\sigma(\theta_i+\gamma)$. Here, we would assume that $\gamma$ is the same for all players. This assumption implies that if player $i$ is better than player $j$ at easy plays, he will also be better at hard plays. This is a reasonable assumption, but maybe not true in all cases.</p>

<p>Since we have five different categories of difficulty, we can generalize this by having $\gamma_k, k=1,\ldots,4$. Again, these $\gamma_k$&rsquo;s would be the same for everyone. A picture of what this looks like for shortstops is below. In this model, every player will effectively be shifting the curve either left or right. A positive $\theta_i$ means the player is better than average and cause the curve to shift left and vice versa for negative $\theta_i$.</p>

<p><img src="/images/InsideEdge/LogitOrdered.png" title="Logit Ordered" ></p>

<p>I modeled this as a multi-level mixed effects model, with the players being random effects and the $\gamma_k$&rsquo;s being fixed. Technically, I should optimize subject to the condition that the $\gamma_k$&rsquo;s are increasing, but the unconstrained optimization always yields increasing $\gamma_k$&rsquo;s because there is a big difference between success rate in the categories. I used combined data from 2012 and 2013 seasons and included all players with at least one success and one failure. I modeled each position separately. Modeling player effects as random, there is a fair amount of regression to the mean built in. In this sense, I am more trying to estimate the true ability of the player, rather than measuring what he did during the two years. This is an important distinction, which may differ from other defensive statistics.</p>

<h3 id="model-fit">Model fit</h3>

<p>Below is a summary of the results of the model for shortstops. I am only plotting the players with the at least 800 innings, for readability. A bonus of modeling the data like this is that we get standard error estimates as a result. I plotted the estimated effect of each player along with +/- 2 standard errors. We can be fairly certain that the effects for the top few shortstops is greater than 0 since their confidence intervals do not include 0. The same is true for the bottom few. Images for the other positions can be found <a href="https://github.com/andland/andland.github.com/tree/master/images/InsideEdge">here</a>.</p>

<p><img src="/images/InsideEdge/SSlist.png" title="Results for shortstops" ></p>

<p>The results seem to make sense for the most part. Simmons and Tulowitzki have reputations as being strong defenders and Derek Jeter has a reputation as a poor defender.</p>

<p>Further, I can validate this data by comparing it to other defensive metrics. One that is readily available on Fangraphs is UZR per 150 games. For each position, I took the correlation of my estimated effect with UZR per 150 games, weighted by the number of innings played. Pitchers and catchers do not have UZR&rsquo;s so I cannot compare them. The correlations, which are in the plot below, range from about 0.2 to 0.65.</p>

<p><img src="/images/InsideEdge/CorrelationWithUZR.png" title="Correlation with UZR" ></p>

<h3 id="interpreting-parameters">Interpreting parameters</h3>

<p>In order to make this fielding metric more useful, I would like to convert the parameters to something more interpretable. One option which makes a lot of sense is &ldquo;plays made above/below average&rdquo;. Given an estimated $\theta_i$ for a player, we can calculate the probability that he would make a play in each of the five categories. We can then compare those probabilities to the probability an average player would make a play in each of the categories, which would be fit with $\theta=0$. Finally, we can weight these differences in probabilities by the relative rate that plays of various difficulties occur. </p>

<p>For example, assuming there are only two categories again, suppose a player has a 0.10 and 0.05 higher probability than average of making hard and easy plays, respectively. Further assume that 75% of all plays are hard and 25% are easy. On a random play, the improvement in probability over an average player of making a play is $.10(.75)+.05(.25)=0.0875$. If a player has an opportunity for 300 plays in an average season, this player would be $300 \times 0.0875=26.25$ plays better than average over a typical season.</p>

<p>I will assume that the number of opportunities to make plays is directly related to the number of innings played. To convert innings to opportunities, I took the median number of opportunities per inning for each position. For example, shortstops had the highest opportunities per inning at 0.40 and catchers had the lowest at 0.08. The plot below shows the distribution of opportunities per inning for each position.</p>

<p><img src="/images/InsideEdge/PlaysPerInning.png" title="Plays Per Inning by Position" ></p>

<p>We can extend this to the impact on saving runs from being scored as well by assuming each successful play saves $x$ runs. I will not do this for this analysis.</p>

<h3 id="results">Results</h3>

<p><a href="http://spark.rstudio.com/andland/InsideEdgeBaseballFielding/"><img src="/images/InsideEdge/shiny.png" title="Shiny app" ></a></p>

<p>Finally, I put together a <a href="http://www.rstudio.com/shiny/">Shiny</a> app to display <a href="http://spark.rstudio.com/andland/InsideEdgeBaseballFielding/">the results</a>. You can search by team, position, and innings played. A team of &lsquo;- - -&lsquo; means the player played for multiple teams over this period. You can also choose to display the results as a rate statistic (extra plays made per season) or a count statistic (extra plays made over the two seasons). To get a seasonal number, I assume position players played 150 games with 8.5 innings in each game. For pitchers, I assumed that they pitched 30 games, 6 innings each. </p>

<h3 id="conclusions-and-future-work">Conclusions and future work</h3>

<p>I don&rsquo;t know if I will do anything more with this data, but if I could do it again, I may have modeled each year separately instead of combining the two years together. With that, it would have been interesting to model the effect of age by observing how a player&rsquo;s ability to make a play changes from one year to the next. I also think it would be interesting to see how changing positions affects a players efficiency. For example, we could have a $9 \times 9$ matrix of fixed effects that represent the improvement or degradation in ability as a player switches from their main position to another one. Further assumptions would be needed to make sure the $\theta$&rsquo;s are on the same scale for every position.</p>

<p>At the very least, this model and its results can be considered another data point in the analysis of a player&rsquo;s fielding ability. One thing we need to be concerned about is the classification of each play into the difficultness categories. The human eye can be fooled into thinking a routine play is hard just because a fielder dove to make the play, when a superior fielder could have made it look easier.</p>

<h3 id="code">Code</h3>

<p>I have put the R code together to do this analysis in <a href="https://gist.github.com/andland/c6adb69ea365c2580859">a gist</a>. If there is interest, I will put together a repo with all the data as well.</p>

<p><strong>Update</strong>: I have a <a href="https://github.com/andland/InsideEdgeFielding">Github repository</a> with the data, R code for the analysis, the results, and code for the Shiny app. Let me know what you think.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Top Songs by Artist on CD102.5 in 2013]]></title>
    <link href="http://andland.github.io/blog/2013/12/27/top-songs-by-artist-on-cd1025-in-2013/"/>
    <updated>2013-12-27T00:00:00-05:00</updated>
    <id>http://andland.github.io/blog/2013/12/27/top-songs-by-artist-on-cd1025-in-2013</id>
    <content type="html"><![CDATA[<div class="post">
In a <a href="http://alandgraf.blogspot.com/2013/08/downloading-and-analyzing-cd1025s.html">previous post</a>, I showed you how to scrape playlist data from Columbus, OH alternative rock station <a href="http://cd1025.com/">CD102.5</a>. Since it's the end of the year and best-of lists are all the fad, I thought I would share the most popular songs and artists of the year, according to this data. In addition to this, I am going to make an interactive graph using <a href="http://www.rstudio.com/shiny/">Shiny</a>, where the user can select an artist and it will graph the <a href="http://spark.rstudio.com/andland/CD1025Playlist/">most popular songs</a> from that artist.<br /><br />First off, I am assuming that you have scraped the appropriate data using the code from the previous post.<br /><br /><pre><code class="r">library(lubridate)<br />library(sqldf)<br /><br />playlist=read.csv("CD101Playlist.csv",stringsAsFactors=FALSE)<br />dates=mdy(substring(playlist[,3],nchar(playlist[,3])-9,nchar(playlist[,3])))<br />times=hm(substring(playlist[,3],1,nchar(playlist[,3])-10))<br />playlist$Month=ymd(paste(year(dates),month(dates),"1",sep="-"))<br />playlist$Day=dates<br />playlist$Time=times<br />playlist=playlist[order(playlist$Day,playlist$Time),]</code></pre><br />Next, I will select just the data from 2013 and find the songs that were played most often. <br /><pre><code class="r">playlist=subset(playlist,Day&gt;=mdy("1/1/13"))<br />playlist$ArtistSong=paste(playlist$Artist,playlist$Song,sep="-")<br />top.songs=sqldf("Select ArtistSong, Count(ArtistSong) as Num<br />      From playlist<br />      Group By ArtistSong<br />      Order by Num DESC<br />      Limit 10")<br /></code></pre><br />The top 10 songs are the following:<br /><pre><code class="r">                              Artist-Song Number Plays<br />1  FITZ AND THE TANTRUMS-OUT OF MY LEAGUE 809<br />2                      ALT J-BREEZEBLOCKS 764<br />3              COLD WAR KIDS-MIRACLE MILE 759<br />4                      ATLAS GENIUS-IF SO 750<br />5                         FOALS-MY NUMBER 687<br />6                         MS MR-HURRICANE 679<br />7       THE NEIGHBOURHOOD-SWEATER WEATHER 657<br />8           CAPITAL CITIES-SAFE AND SOUND 646<br />9             VAMPIRE WEEKEND-DIANE YOUNG 639<br />10             THE FEATURES-THIS DISORDER 632<br /></code></pre><br />I will make a plot similar to the plots made in <a href="http://alandgraf.blogspot.com/2013/08/when-did-cd1025-book-summerfest-artists.html">the last post</a> to show when the top 5 songs were played throughout the year.<br /><pre><code class="r">    <br />plays.per.day=sqldf("Select Day, Count(Artist) as Num<br />      From playlist<br />      Group By Day<br />      Order by Day")<br /><br />playlist.top.songs=subset(playlist,ArtistSong %in% top.songs$ArtistSong[1:5])<br /><br />song.per.day=sqldf(paste0("Select Day, ArtistSong, Count(ArtistSong) as Num<br />                          From [playlist.top.songs]<br />                          Group By Day, ArtistSong<br />                          Order by Day, ArtistSong"))<br />dspd=dcast(song.per.day,Day~ArtistSong,sum,value.var="Num")<br /><br />song.per.day=merge(plays.per.day[,1,drop=FALSE],dspd,all.x=TRUE)<br />song.per.day[is.na(song.per.day)]=0<br /><br />song.per.day=melt(song.per.day,1,variable.name="ArtistSong",value.name="Num")<br />song.per.day$Alpha=ifelse(song.per.day$Num&gt;0,1,0)<br /><br />library(ggplot2)<br />ggplot(song.per.day,aes(Day,Num,colour=ArtistSong))+geom_point(aes(alpha=Alpha))+<br />  geom_smooth(method="gam",family=poisson,formula=y~s(x),se=F,size=1)+<br />  labs(x="Date",y="Plays Per Day",title="Top Songs",colour=NULL)+<br />  scale_alpha_continuous(guide=FALSE,range=c(0,.5))+theme_bw()<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-JWP3RQkgQeo/Ur4-RG1px7I/AAAAAAAAH-U/JH6gP0Jk6Tc/s1600/TopSongs.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-JWP3RQkgQeo/Ur4-RG1px7I/AAAAAAAAH-U/JH6gP0Jk6Tc/s1600/TopSongs.png" /></a></div>Alt-J was more popular in the beginning of the year and the Foals have been more popular recently.<br /><br />I can similarly summarize by artist as well.<br /><pre><code class="r">top.artists=sqldf("Select Artist, Count(Artist) as Num<br />                From playlist<br />                Group By Artist<br />                Order by Num DESC<br />                Limit 10")<br /></code></pre><br /><pre><code class="r">                    Artist  Num<br />1                     MUSE 1683<br />2          VAMPIRE WEEKEND 1504<br />3        SILVERSUN PICKUPS 1442<br />4                    FOALS 1439<br />5                  PHOENIX 1434<br />6            COLD WAR KIDS 1425<br />7                JAKE BUGG 1316<br />8  QUEENS OF THE STONE AGE 1296<br />9                    ALT J 1233<br />10     OF MONSTERS AND MEN 1150<br /></code></pre><br /><pre><code class="r">playlist.top.artists=subset(playlist,Artist %in% top.artists$Artist[1:5])<br /><br />artists.per.day=sqldf(paste0("Select Day, Artist, Count(Artist) as Num<br />                          From [playlist.top.artists]<br />                          Group By Day, Artist<br />                          Order by Day, Artist"))<br />dspd=dcast(artists.per.day,Day~Artist,sum,value.var="Num")<br /><br />artists.per.day=merge(plays.per.day[,1,drop=FALSE],dspd,all.x=TRUE)<br />artists.per.day[is.na(artists.per.day)]=0<br /><br />artists.per.day=melt(artists.per.day,1,variable.name="Artist",value.name="Num")<br />artists.per.day$Alpha=ifelse(artists.per.day$Num&gt;0,1,0)<br /><br />ggplot(artists.per.day,aes(Day,Num,colour=Artist))+geom_point(aes(alpha=Alpha))+<br />  geom_smooth(method="gam",family=poisson,formula=y~s(x),se=F,size=1)+<br />  labs(x="Date",y="Plays Per Day",title="Top Artists",colour=NULL)+<br />  scale_alpha_continuous(guide=FALSE,range=c(0,.5))+theme_bw()<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-57hZwciuIug/Ur5AO9l7NWI/AAAAAAAAH-g/Xi2_4e-FwZw/s1600/TopArtist.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-57hZwciuIug/Ur5AO9l7NWI/AAAAAAAAH-g/Xi2_4e-FwZw/s1600/TopArtist.png" /></a></div>The pattern for the artists are not as clear as it is for the songs.<br /><br />Finally, I wrote <a href="http://spark.rstudio.com/andland/CD1025Playlist/">a Shiny interactive app</a>. They are surprisingly easy to create and if you are thinking about experimenting with it, I suggest you try it. I will leave the code for the app in <a href="https://gist.github.com/andland/8155783">a gist</a>. In <a href="http://spark.rstudio.com/andland/CD1025Playlist/">the app</a>, you can enter any artist you want, and it will show you the most popular songs on CD102.5 for that artist. You can also select the number of songs that it plots with the slider.<br /><br />For example, even though Muse did not have one of the most popular songs of the year, they were still the band that was played the most. By typing in "MUSE" in the Artist text input, you will get the <a href="http://spark.rstudio.com/andland/CD1025Playlist/">following output</a>.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-EuKnItqFzCo/Ur5CQELkw0I/AAAAAAAAH-s/Pv4dJwueLQM/s1600/Muse.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-EuKnItqFzCo/Ur5CQELkw0I/AAAAAAAAH-s/Pv4dJwueLQM/s1600/Muse.png" /></a></div>They had two songs that were very popular this year and a few others that were decently popular as well.<br /><br /><a href="http://spark.rstudio.com/andland/CD1025Playlist/">Play around</a> with it and let me know what you think.</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[When Did CD102.5 Book the Summerfest Artists?]]></title>
    <link href="http://andland.github.io/blog/2013/08/27/when-did-cd1025-book-summerfest-artists/"/>
    <updated>2013-08-27T00:00:00-04:00</updated>
    <id>http://andland.github.io/blog/2013/08/27/when-did-cd1025-book-summerfest-artists</id>
    <content type="html"><![CDATA[<div class="post">
<iframe frameborder="0" height="4775" scrolling="no" src="https://dl.dropboxusercontent.com/u/17648661/CD101summerfest.html" width="100%">&amp;lt;p&amp;gt;Loading ...&amp;lt;/p&amp;gt;</iframe></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Downloading and Analyzing CD1025's Playlist]]></title>
    <link href="http://andland.github.io/blog/2013/08/20/downloading-and-analyzing-cd1025s/"/>
    <updated>2013-08-20T00:00:00-04:00</updated>
    <id>http://andland.github.io/blog/2013/08/20/downloading-and-analyzing-cd1025s</id>
    <content type="html"><![CDATA[<div class="post">
<a href="http://www.cd101.com/">CD1025</a> is an “alternative” radio station here in Columbus. They are one of the few remaining radio stations that are independently owned and they take great pride in it. For data nerds like me, they also put a real time list of recently played songs on <a href="http://cd1025.com/about/playlists/now-playing">their website</a>. The page has the most recent 50 songs played, but you can also click on “Older Tracks” to go back in time. When you do this, the URL ends “now-playing/?start=50”. If you got back again, it says “now-playing/?start=100”.<br /><br />Using this structure, I decided to see if I could download all of their historical data and see how far it goes back. In the code below, I use the XML package to go to the website and download the 50 songs and then increment the number by 50 to find the previous 50 songs. I am telling the code to keep doing this until I get to January 1, 2012.<br /><pre><code class="r">library(ggplot2)<br />theme_set(theme_bw())<br />library(XML)<br />library(lubridate)<br />library(sqldf)<br />startNum = 0<br />while (TRUE) {<br />    theurl &lt;- paste0("http://cd1025.com/about/playlists/now-playing/?start=", <br />        startNum)<br />    table &lt;- readHTMLTable(theurl, stringsAsFactors = FALSE)[[1]]<br />    if (startNum == 0) {<br />        playlist = table[, -1]<br />    } else {<br />        playlist = rbind(playlist, table[, -1])<br />    }<br />    dt = mdy(substring(table[1, 4], nchar(table[1, 4]) - 9, nchar(table[1, 4])))<br />    print(dt)<br />    if (dt &lt; mdy("1/1/12")) {<br />        break<br />    }<br />    startNum = startNum + 50<br />}<br /><br />playlist = unique(playlist)  # Remove Dupes<br /><br />write.csv(playlist, "CD101Playlist.csv", row.names = FALSE)<br /></code></pre>This takes a while and is fairly large. My file has over 150,000 songs. If you want just a little data, change the date to last week or so. The first thing I will do is parse the dates and times of the songs, order them, and look at the first few songs. You can see that data only goes back to March of 2012.<br /><pre><code class="r">dates = mdy(substring(playlist[, 3], nchar(playlist[, 3]) - 9, nchar(playlist[, <br />    3])))<br />times = hm(substring(playlist[, 3], 1, nchar(playlist[, 3]) - 10))<br />playlist$Month = ymd(paste(year(dates), month(dates), "1", sep = "-"))<br />playlist$Day = dates<br />playlist$Time = times<br />playlist = playlist[order(playlist$Day, playlist$Time), ]<br />head(playlist)<br /></code></pre><pre><code>##                     Artist                Song       Last.Played<br />## 151638 DEATH CAB FOR CUTIE   YOU ARE A TOURIST 12:34am03/01/2012<br />## 151637       SLEEPER AGENT          GET BURNED 12:38am03/01/2012<br />## 151636          WASHED OUT           AMOR FATI 12:41am03/01/2012<br />## 151635            COLDPLAY       CHARLIE BROWN 12:45am03/01/2012<br />## 151634           GROUPLOVE         TONGUE TIED 12:49am03/01/2012<br />## 151633               SUGAR YOUR FAVORITE THING 12:52am03/01/2012<br />##             Month        Day   Time<br />## 151638 2012-03-01 2012-03-01 34M 0S<br />## 151637 2012-03-01 2012-03-01 38M 0S<br />## 151636 2012-03-01 2012-03-01 41M 0S<br />## 151635 2012-03-01 2012-03-01 45M 0S<br />## 151634 2012-03-01 2012-03-01 49M 0S<br />## 151633 2012-03-01 2012-03-01 52M 0S<br /></code></pre>Using the sqldf package, I can easily see what the most played artists and songs are from the data I scraped.<br /><pre><code class="r">sqldf("Select Artist, Count(Artist) as PlayCount<br />       From playlist<br />       Group By Artist<br />       Order by PlayCount DESC<br />       Limit 10")<br /></code></pre><pre><code>##                   Artist PlayCount<br />## 1      SILVERSUN PICKUPS      2340<br />## 2         THE BLACK KEYS      2203<br />## 3                   MUSE      1988<br />## 4              THE SHINS      1885<br />## 5    OF MONSTERS AND MEN      1753<br />## 6            PASSION PIT      1552<br />## 7              GROUPLOVE      1544<br />## 8  RED HOT CHILI PEPPERS      1514<br />## 9                 METRIC      1495<br />## 10          ATLAS GENIUS      1494<br /></code></pre><pre><code class="r"><br />sqldf("Select Artist, Song, Count(Song) as PlayCount<br />      From playlist<br />      Group By Artist, Song<br />      Order by PlayCount DESC<br />      Limit 10")<br /></code></pre><pre><code>##                 Artist                    Song PlayCount<br />## 1          PASSION PIT             TAKE A WALK       828<br />## 2    SILVERSUN PICKUPS                PIT, THE       825<br />## 3         ATLAS GENIUS                 TROJANS       819<br />## 4        WALK THE MOON                ANNA SUN       742<br />## 5       THE BLACK KEYS LITTLE BLACK SUBMARINES       736<br />## 6          DIVINE FITS  WOULD THAT NOT BE NICE       731<br />## 7        THE LUMINEERS                  HO HEY       722<br />## 8       CAPITAL CITIES          SAFE AND SOUND       712<br />## 9  OF MONSTERS AND MEN          MOUNTAIN SOUND       711<br />## 10               ALT J            BREEZEBLOCKS       691<br /></code></pre>I am a little surprised that Silversun Pickups are the number one band, but everyone on the list makes sense. Looking at how the plays of the top artists have varied from month to month, you can see a few patterns. Muse has been more popular recently and The Shins and Grouplove have lost some steam.<br /><pre><code class="r">artist.month=sqldf("Select Month, Artist, Count(Song) as Num<br />      From playlist<br />      Group By Month, Artist<br />      Order by Month, Artist")<br />artist=sqldf("Select Artist, Count(Artist) as Num<br />      From playlist<br />      Group By Artist<br />      Order by Num DESC")<br />p=ggplot(subset(artist.month,Artist %in% head(artist$Artist,8)),aes(Month,Num))<br />p+geom_bar(stat="identity",aes(fill=Artist),position='fill',colour="grey")+</code></pre><pre><code class="r"> labs(y="Percentage of Plays")</code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-ZbWCMOMUX8E/UhPvnh1UoqI/AAAAAAAAH8I/EIAlTwFKjxg/s1600/PlayProportionByMonth.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-ZbWCMOMUX8E/UhPvnh1UoqI/AAAAAAAAH8I/EIAlTwFKjxg/s1600/PlayProportionByMonth.png" /></a></div><br />For the play count of the top artists, I see some odd numbers in June and July of 2012. The number of plays went way down.<br /><pre><code class="r">p + geom_area(aes(fill = Artist), position = "stack", colour = 1) + labs(y = "Number of Plays")<br /></code></pre><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/--0tLMWDJuAI/UhPvnsQAl2I/AAAAAAAAH8M/tl2RtleoH2k/s1600/PlayCountByMonth.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/--0tLMWDJuAI/UhPvnsQAl2I/AAAAAAAAH8M/tl2RtleoH2k/s1600/PlayCountByMonth.png" /></a></div><br />Looking into this further, I plotted the date and time that the song was played by the cumulative number of songs played since the beginning of the list. The plot should be a line with a constant slope, meaning that the plays per day are relatively constant. You can see in June and July of 2012 there are flat spots where there is no playlist history. <br /><pre><code class="r">qplot(playlist$Day + playlist$Time, 1:length(dates), geom = "path")<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-jzAKuFMa_ak/UhPvnqrS-_I/AAAAAAAAH8E/DgJDVUUNyD8/s1600/PlaysByTime.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-jzAKuFMa_ak/UhPvnqrS-_I/AAAAAAAAH8E/DgJDVUUNyD8/s1600/PlaysByTime.png" /></a></div><br />There are also smaller flat spots in September and December, but I am going to decide that those are small enough not to affect any further analyses. From this, I am going to use data only from August 2012 to present.<br /><pre><code class="r">playlist = subset(playlist, Day &gt;= mdy("8/1/12"))<br /></code></pre>Next up, I am going to use this data to analyze the plays of artists from <a href="http://cd1025.com/summerfest">Summerfest</a>, and try to infer if the play counts varied once they were added to the bill.</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[What Is the Probability of a 16 Seed Beating a 1 Seed?]]></title>
    <link href="http://andland.github.io/blog/2013/04/21/what-is-probability-of-16-seed-beating/"/>
    <updated>2013-04-21T00:00:00-04:00</updated>
    <id>http://andland.github.io/blog/2013/04/21/what-is-probability-of-16-seed-beating</id>
    <content type="html"><![CDATA[<div class="post">
<i><span id="goog_1885060128"></span><span id="goog_1885060129"></span>Note: I started this post way back when the NCAA men's basketball tournament was going on, but didn't finish it until now. </i><br /><br />Since the NCAA Men's Basketball Tournament has moved to 64 teams, a 16 seed as never upset a 1 seed. You might be tempted to say that the probability of such an event must be 0 then. But we know better than that.<br /><br />In this post, I am interested in looking at different ways of estimating how the odds of winning a game change as the difference between seeds increases. I was able to download tournament data going back to the 1930s until 2012 from <a href="http://hoopstournament.net/Database.html">hoopstournament.net/Database.html</a>. The tournament expanded to 64 teams in 1985, which is what I used for this post. I only used match ups in which one of the seeds was higher than the other because this was the easiest way to remove duplicates. (The database has each game listed twice, once with the winner as the first team and once with the loser as the first team. The vast majority (98.9%) of games had one team as a higher seed because an equal seed can only happen at the Final Four or later.)<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><span style="color: #339933;">;</span> theme_set<span style="color: #009900;">(</span>theme_bw<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />brackets=<a href="http://inside-r.org/r-doc/utils/read.csv"><span style="color: #003399; font-weight: bold;">read.csv</span></a><span style="color: #009900;">(</span><span style="color: blue;">"NCAAHistory.csv"</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># use only data from 1985 on in which the first team has the higher seed</span><br />brackets=<a href="http://inside-r.org/r-doc/base/subset"><span style="color: #003399; font-weight: bold;">subset</span></a><span style="color: #009900;">(</span>brackets<span style="color: #339933;">,</span>Seed&lt;Opponent.Seed &amp; Year&gt;=<span style="color: #cc66cc;">1985</span> &amp; <a href="http://inside-r.org/r-doc/base/Round"><span style="color: #003399; font-weight: bold;">Round</span></a>!=<span style="color: blue;">"Opening Round"</span><span style="color: #009900;">)</span><br />&nbsp;<br />brackets$SeedDiff=<a href="http://inside-r.org/r-doc/base/abs"><span style="color: #003399; font-weight: bold;">abs</span></a><span style="color: #009900;">(</span>brackets$Opponent.Seed-brackets$Seed<span style="color: #009900;">)</span><br />brackets$HigherSeedWon=<a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">(</span>brackets$Opponent.Seed&gt;brackets$Seed<span style="color: #339933;">,</span>brackets$Wins<span style="color: #339933;">,</span>brackets$Losses<span style="color: #009900;">)</span><br />brackets$HigherSeedScoreDiff=<a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">(</span>brackets$Opponent.Seed&gt;brackets$Seed<span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>-<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>*<span style="color: #009900;">(</span>brackets$Score-brackets$Opponent.Score<span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><h3>Use Frequencies</h3><div class="separator" style="clear: both; text-align: center;"></div>The first way is the most simple: look at the historical records when a 16 seed is playing a 1 seed (where the seed difference is 15). As you can see from the plot below, when the seed difference is 15, the higher seeded team has won every time. This is also true when the seed difference is 12, although there have only been 4 games in this scenario. Another oddity is that when the seed difference is 10, the higher seed only has only won 50% of the time. Again, this is largely due to the fact that there have only been 6 games with this seed difference.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">seed.diffs=<a href="http://inside-r.org/r-doc/base/sort"><span style="color: #003399; font-weight: bold;">sort</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/unique"><span style="color: #003399; font-weight: bold;">unique</span></a><span style="color: #009900;">(</span>brackets$SeedDiff<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />win.pct=<a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/mean"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900;">(</span>brackets$HigherSeedWon<span style="color: #009900;">[</span>brackets$SeedDiff==x<span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span>win.pct<span style="color: #009900;">)</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span>win.pct<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+geom_point<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+<br />  geom_hline<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0.5</span><span style="color: #339933;">,</span>linetype=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Proportion of Games Won by Higher Seed"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-4FoTKgiyX10/UXLrF8YV2tI/AAAAAAAAHtU/jgQ3FfibzQg/s1600/Frequencies.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-4FoTKgiyX10/UXLrF8YV2tI/AAAAAAAAHtU/jgQ3FfibzQg/s1600/Frequencies.jpeg" /></a></div><br /><h3>Use Score Difference</h3>In many applications, it has been shown that using margin of victory is much more reliable than just wins and losses. For example, in the computer ranking of College Football teams, using score differences is more accurate, but outlawed for fear that teams would run up the score on weaker opponents. So the computer rankings are not as strong as they could be.<br /><br />We have no such conflict of interest, so we should try to make use of any information available. A simple way to do that is to look at the mean and standard deviation of the margin of victory when the 16 seed is playing the 1 seed. Below is a plot of the mean score difference with a ribbon for the +/- 2 standard deviations.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">seed.diffs=<a href="http://inside-r.org/r-doc/base/sort"><span style="color: #003399; font-weight: bold;">sort</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/unique"><span style="color: #003399; font-weight: bold;">unique</span></a><span style="color: #009900;">(</span>brackets$SeedDiff<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />means=<a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/mean"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900;">(</span>brackets$HigherSeedScoreDiff<span style="color: #009900;">[</span>brackets$SeedDiff==x<span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />sds=<a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/stats/sd"><span style="color: #003399; font-weight: bold;">sd</span></a><span style="color: #009900;">(</span>brackets$HigherSeedScoreDiff<span style="color: #009900;">[</span>brackets$SeedDiff==x<span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span>means<span style="color: #339933;">,</span>sds<span style="color: #009900;">)</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span>means<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  geom_ribbon<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>ymin=means-<span style="color: #cc66cc;">2</span>*sds<span style="color: #339933;">,</span>ymax=means+<span style="color: #cc66cc;">2</span>*sds<span style="color: #009900;">)</span><span style="color: #339933;">,</span>alpha=<span style="color: #cc66cc;">.5</span><span style="color: #009900;">)</span>+geom_point<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+geom_line<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+<br />  geom_hline<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>linetype=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Margin of Victory by Higher Seed"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-4VaSHpRws2A/UXLrGMODjhI/AAAAAAAAHtQ/7JrGAbDYY4A/s1600/MarginOfVictory.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-4VaSHpRws2A/UXLrGMODjhI/AAAAAAAAHtQ/7JrGAbDYY4A/s1600/MarginOfVictory.jpeg" /></a></div><br /><br />You can see that the ribbon includes zero for all seed differences except 15. If we assume that the score differences are roughly normal, we can calculate the probability that the score difference will be greater than 0. The results are largely the same as before, but we see now that there are no 100% estimates. Also, the 50% win percentage for a seed difference of 10 now looks a little more reasonable, albeit still out of line with the rest.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span>means<span style="color: #339933;">,</span>sds<span style="color: #009900;">)</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span>-<a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>means<span style="color: #339933;">,</span>sds<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  geom_point<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+geom_line<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+geom_hline<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0.5</span><span style="color: #339933;">,</span>linetype=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Probability of Higher Seed Winning Based on Margin of Victory"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-0IRgSQFoL9M/UXLrF7iNsYI/AAAAAAAAHtM/G-7h8k1yLAA/s1600/ProbMarginOfVictory.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-0IRgSQFoL9M/UXLrF7iNsYI/AAAAAAAAHtM/G-7h8k1yLAA/s1600/ProbMarginOfVictory.jpeg" /></a></div><br /><h3>Model Win Percentage as a Function of&nbsp; Seed Difference</h3>It is always good to incorporate as much knowledge as possible into an analysis. In this case, we have information on other games besides the 16 versus 1 seed game which help us estimate the 16 versus 1 game. For example, it is reasonable to assume that the larger the difference in seed is, the more likely the higher seed will win. We can build a logistic regression model which looks at all of the outcomes of all of the games and predicts the probability of winning based on the difference in seed. When the two teams have the same seed, I enforced the probability of the higher seed winning to be 0.5 by making the intercept 0.<br /><br />In the plot below, you can see that the logistic model predicts that the probability of winning increases throughout until reaching about 90% for the 16 versus 1. I also included a non-linear generalized additive model (GAM) model for comparison. The GAM believes that being a big favorite (16 vs 1 or 15 vs 2) gives an little boost in win probability. An advantage of modeling is that we can make predictions for match-ups that have never occurred (like a seed difference of 14). <br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=brackets<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>SeedDiff<span style="color: #339933;">,</span>HigherSeedWon<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  stat_smooth<span style="color: #009900;">(</span>method=<span style="color: blue;">"gam"</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<span style="color: blue;">"binomial"</span><span style="color: #339933;">,</span>se=F<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/formula"><span style="color: #003399; font-weight: bold;">formula</span></a>=y~<span style="color: #cc66cc;">0</span>+x<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>colour=<span style="color: blue;">"Logistic"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  stat_smooth<span style="color: #009900;">(</span>method=<span style="color: blue;">"gam"</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<span style="color: blue;">"binomial"</span><span style="color: #339933;">,</span>se=F<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/formula"><span style="color: #003399; font-weight: bold;">formula</span></a>=y~<a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399; font-weight: bold;">s</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>colour=<span style="color: blue;">"GAM"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_jitter<span style="color: #009900;">(</span>alpha=<span style="color: #cc66cc;">.15</span><span style="color: #339933;">,</span>position = position_jitter<span style="color: #009900;">(</span>height = <span style="color: #cc66cc;">.025</span><span style="color: #339933;">,</span>width=<span style="color: #cc66cc;">.25</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Game Won by Higher Seed"</span><span style="color: #339933;">,</span>colour=<span style="color: blue;">"Model"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-QYWl4914Phc/UXLwH3ls3mI/AAAAAAAAHtY/7CMeKo0ZH5M/s1600/Model01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-QYWl4914Phc/UXLwH3ls3mI/AAAAAAAAHtY/7CMeKo0ZH5M/s1600/Model01.jpeg" /></a></div><br /><h3>Model Score Difference as a Function of&nbsp; Seed Difference</h3>We can also do the same thing with margin of victory. Here, I constrain the linear model to have an intercept of 0, meaning that two teams with the same seed should be evenly matched. Again, I included the GAM fit for comparison. The interpretations are similar to before, in that it seems that there is an increase in margin of victory for the heavily favored teams.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=brackets<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>SeedDiff<span style="color: #339933;">,</span>HigherSeedScoreDiff<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  stat_smooth<span style="color: #009900;">(</span>method=<span style="color: blue;">"lm"</span><span style="color: #339933;">,</span>se=F<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/formula"><span style="color: #003399; font-weight: bold;">formula</span></a>=y~<span style="color: #cc66cc;">0</span>+x<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>colour=<span style="color: blue;">"Linear"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  stat_smooth<span style="color: #009900;">(</span>method=<span style="color: blue;">"gam"</span><span style="color: #339933;">,</span>se=F<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/formula"><span style="color: #003399; font-weight: bold;">formula</span></a>=y~<a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399; font-weight: bold;">s</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>colour=<span style="color: blue;">"GAM"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_jitter<span style="color: #009900;">(</span>alpha=<span style="color: #cc66cc;">.25</span><span style="color: #339933;">,</span>position = position_jitter<span style="color: #009900;">(</span>height = <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>width=<span style="color: #cc66cc;">.25</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Margin of Victory by Higher Seed"</span><span style="color: #339933;">,</span>colour=<span style="color: blue;">"Model"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-ncQ9W4oFjU8/UXLyGTZLNuI/AAAAAAAAHtg/5MqlA6ZbX8c/s1600/ModelDiff.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-ncQ9W4oFjU8/UXLyGTZLNuI/AAAAAAAAHtg/5MqlA6ZbX8c/s1600/ModelDiff.jpeg" /></a></div><br />From these models of margin of victory we can infer the probability of the higher seed winning (again, assuming normality).<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/mgcv/gam"><span style="color: #003399; font-weight: bold;">gam</span></a><span style="color: #009900;">)</span><br />lm.seed=<a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">(</span>HigherSeedScoreDiff~<span style="color: #cc66cc;">0</span>+SeedDiff<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=brackets<span style="color: #009900;">)</span><br />gam.seed=<a href="http://inside-r.org/r-doc/mgcv/gam"><span style="color: #003399; font-weight: bold;">gam</span></a><span style="color: #009900;">(</span>HigherSeedScoreDiff~<a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399; font-weight: bold;">s</span></a><span style="color: #009900;">(</span>SeedDiff<span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=brackets<span style="color: #009900;">)</span><br />&nbsp;<br />pred.lm.seed=<a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">(</span>lm.seed<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=<span style="color: #cc66cc;">0</span>:<span style="color: #cc66cc;">15</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>se.fit=<span style="color: black; font-weight: bold;">TRUE</span><span style="color: #009900;">)</span><br />pred.gam.seed=<a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">(</span>gam.seed<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=<span style="color: #cc66cc;">0</span>:<span style="color: #cc66cc;">15</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>se.fit=<span style="color: black; font-weight: bold;">TRUE</span><span style="color: #009900;">)</span><br />se.lm=<a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/mean"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900;">(</span>lm.seed$residuals^<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />se.gam=<a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/mean"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900;">(</span>gam.seed$residuals^<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />&nbsp;<br />df1=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=<span style="color: #cc66cc;">0</span>:<span style="color: #cc66cc;">15</span><span style="color: #339933;">,</span>ProbLM=<span style="color: #cc66cc;">1</span>-<a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>pred.lm.seed$fit<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span>se.lm^<span style="color: #cc66cc;">2</span>+pred.lm.seed$se.fit^<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />               ProbGAM=<span style="color: #cc66cc;">1</span>-<a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>pred.gam.seed$fit<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span>se.gam^<span style="color: #cc66cc;">2</span>+pred.gam.seed$se.fit^<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>df1<span style="color: #009900;">)</span>+geom_hline<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0.5</span><span style="color: #339933;">,</span>linetype=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>SeedDiff<span style="color: #339933;">,</span>ProbLM<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Linear"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>SeedDiff<span style="color: #339933;">,</span>ProbGAM<span style="color: #339933;">,</span>colour=<span style="color: blue;">"GAM"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Probability of Higher Seed Winning"</span><span style="color: #339933;">,</span>colour=<span style="color: blue;">"Model"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-ZI7n4agC0J8/UXL4fH2dTzI/AAAAAAAAHts/6ia23BR7e7w/s1600/ModelDiffProbs.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-ZI7n4agC0J8/UXL4fH2dTzI/AAAAAAAAHts/6ia23BR7e7w/s1600/ModelDiffProbs.jpeg" /></a></div><br /><h3>Summary</h3>Putting all of the estimates together, you can easily spot the differences between the models. The two assumptions that just used the data between specific seeds look pretty similar. It looks like using score differential is a little more reasonable of the two. The two GAMs have a similar trend and so did the&nbsp; linear and logistic models. If someone asks you what the probability that a 16 seed beats a 1 seed, you have at least 6 different answers.<br /><br />This post highlights the many different ways someone can analyze the same data. Simply statistics talked a bit about this in a <a href="http://simplystatistics.org/2013/04/19/podcast-7-reinhart-rogoff-reproducibility/">recent podcast</a>. In this case, the differences are not huge, but there are noticeable changes. So the next time you read about an analysis that someone did, keep in mind all the decisions that they had to make and what type a sensitivity they would have on the results.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">logit.seed=<a href="http://inside-r.org/r-doc/stats/glm"><span style="color: #003399; font-weight: bold;">glm</span></a><span style="color: #009900;">(</span>HigherSeedWon~<span style="color: #cc66cc;">0</span>+SeedDiff<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=brackets<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<a href="http://inside-r.org/r-doc/stats/binomial"><span style="color: #003399; font-weight: bold;">binomial</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/boot/logit"><span style="color: #003399; font-weight: bold;">logit</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />logit.seed.gam=<a href="http://inside-r.org/r-doc/mgcv/gam"><span style="color: #003399; font-weight: bold;">gam</span></a><span style="color: #009900;">(</span>HigherSeedWon~<a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399; font-weight: bold;">s</span></a><span style="color: #009900;">(</span>SeedDiff<span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=brackets<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<a href="http://inside-r.org/r-doc/stats/binomial"><span style="color: #003399; font-weight: bold;">binomial</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/boot/logit"><span style="color: #003399; font-weight: bold;">logit</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />&nbsp;<br />df2=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=<span style="color: #cc66cc;">0</span>:<span style="color: #cc66cc;">15</span><span style="color: #339933;">,</span><br />               ProbLM=<span style="color: #cc66cc;">1</span>-<a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>pred.lm.seed$fit<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span>se.lm^<span style="color: #cc66cc;">2</span>+pred.lm.seed$se.fit^<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />               ProbGAM=<span style="color: #cc66cc;">1</span>-<a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>pred.gam.seed$fit<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span>se.gam^<span style="color: #cc66cc;">2</span>+pred.gam.seed$se.fit^<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />               ProbLogit=<a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">(</span>logit.seed<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=<span style="color: #cc66cc;">0</span>:<span style="color: #cc66cc;">15</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>type=<span style="color: blue;">"response"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />               ProbLogitGAM=<a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">(</span>logit.seed.gam<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=<span style="color: #cc66cc;">0</span>:<span style="color: #cc66cc;">15</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>type=<span style="color: blue;">"response"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />df2=<a href="http://inside-r.org/r-doc/base/merge"><span style="color: #003399; font-weight: bold;">merge</span></a><span style="color: #009900;">(</span>df2<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=seed.diffs<span style="color: #339933;">,</span>ProbFreq=win.pct<span style="color: #009900;">)</span><span style="color: #339933;">,</span>all.x=T<span style="color: #009900;">)</span><br />df2=<a href="http://inside-r.org/r-doc/base/merge"><span style="color: #003399; font-weight: bold;">merge</span></a><span style="color: #009900;">(</span>df2<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=seed.diffs<span style="color: #339933;">,</span>ProbScore=<span style="color: #cc66cc;">1</span>-<a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>means<span style="color: #339933;">,</span>sds<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>all.x=T<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>df2<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>SeedDiff<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+geom_hline<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0.5</span><span style="color: #339933;">,</span>linetype=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbLM<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Linear"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbGAM<span style="color: #339933;">,</span>colour=<span style="color: blue;">"GAM"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbLogit<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Logistic"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbLogitGAM<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Logistic GAM"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbFreq<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Frequencies"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbScore<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Score Diff"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_point<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbFreq<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Frequencies"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">3</span><span style="color: #009900;">)</span>+<br />  geom_point<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbScore<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Score Diff"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">3</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Probability of Higher Seed Winning"</span><span style="color: #339933;">,</span>colour=<span style="color: blue;">"Model"</span><span style="color: #009900;">)</span><br />&nbsp;<br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>df2<span style="color: #009900;">)</span>+geom_hline<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0.5</span><span style="color: #339933;">,</span>linetype=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+<br />  geom_point<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>x=SeedDiff<span style="color: #339933;">,</span>y=ProbFreq<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Frequencies"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-hLA30tdetII/UXL4fBT844I/AAAAAAAAHtw/hZiyPKG1o_g/s1600/AllProbs.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-hLA30tdetII/UXL4fBT844I/AAAAAAAAHtw/hZiyPKG1o_g/s1600/AllProbs.jpeg" /></a></div><br /><i>Note that the GAM functions did not have a way to easily restrict the win probability be equal to exactly 0.5 when the seed difference is 0. That is why you may notice the GAM model is a bit above 0.5 at 0.</i></div>
]]></content>
  </entry>
  
</feed>
