<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: statistics | Andrew Landgraf's Blog]]></title>
  <link href="http://andland.github.io/blog/categories/statistics/atom.xml" rel="self"/>
  <link href="http://andland.github.io/"/>
  <updated>2013-07-06T10:33:05-04:00</updated>
  <id>http://andland.github.io/</id>
  <author>
    <name><![CDATA[Andrew Landgraf]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[What Is the Probability of a 16 Seed Beating a 1 Seed?]]></title>
    <link href="http://andland.github.io/blog/2013/04/21/what-is-probability-of-16-seed-beating/"/>
    <updated>2013-04-21T00:00:00-04:00</updated>
    <id>http://andland.github.io/blog/2013/04/21/what-is-probability-of-16-seed-beating</id>
    <content type="html"><![CDATA[<div class='post'>
<i><span id="goog_1885060128"></span><span id="goog_1885060129"></span>Note: I started this post way back when the NCAA men's basketball tournament was going on, but didn't finish it until now. </i><br /><br />Since the NCAA Men's Basketball Tournament has moved to 64 teams, a 16 seed as never upset a 1 seed. You might be tempted to say that the probability of such an event must be 0 then. But we know better than that.<br /><br />In this post, I am interested in looking at different ways of estimating how the odds of winning a game change as the difference between seeds increases. I was able to download tournament data going back to the 1930s until 2012 from <a href="http://hoopstournament.net/Database.html">hoopstournament.net/Database.html</a>. The tournament expanded to 64 teams in 1985, which is what I used for this post. I only used match ups in which one of the seeds was higher than the other because this was the easiest way to remove duplicates. (The database has each game listed twice, once with the winner as the first team and once with the loser as the first team. The vast majority (98.9%) of games had one team as a higher seed because an equal seed can only happen at the Final Four or later.)<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><span style="color: #339933;">;</span> theme_set<span style="color: #009900;">(</span>theme_bw<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />brackets=<a href="http://inside-r.org/r-doc/utils/read.csv"><span style="color: #003399; font-weight: bold;">read.csv</span></a><span style="color: #009900;">(</span><span style="color: blue;">"NCAAHistory.csv"</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># use only data from 1985 on in which the first team has the higher seed</span><br />brackets=<a href="http://inside-r.org/r-doc/base/subset"><span style="color: #003399; font-weight: bold;">subset</span></a><span style="color: #009900;">(</span>brackets<span style="color: #339933;">,</span>Seed&lt;Opponent.Seed &amp; Year&gt;=<span style="color: #cc66cc;">1985</span> &amp; <a href="http://inside-r.org/r-doc/base/Round"><span style="color: #003399; font-weight: bold;">Round</span></a>!=<span style="color: blue;">"Opening Round"</span><span style="color: #009900;">)</span><br />&nbsp;<br />brackets$SeedDiff=<a href="http://inside-r.org/r-doc/base/abs"><span style="color: #003399; font-weight: bold;">abs</span></a><span style="color: #009900;">(</span>brackets$Opponent.Seed-brackets$Seed<span style="color: #009900;">)</span><br />brackets$HigherSeedWon=<a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">(</span>brackets$Opponent.Seed&gt;brackets$Seed<span style="color: #339933;">,</span>brackets$Wins<span style="color: #339933;">,</span>brackets$Losses<span style="color: #009900;">)</span><br />brackets$HigherSeedScoreDiff=<a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">(</span>brackets$Opponent.Seed&gt;brackets$Seed<span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>-<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>*<span style="color: #009900;">(</span>brackets$Score-brackets$Opponent.Score<span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><h3>Use Frequencies</h3><div class="separator" style="clear: both; text-align: center;"></div>The first way is the most simple: look at the historical records when a 16 seed is playing a 1 seed (where the seed difference is 15). As you can see from the plot below, when the seed difference is 15, the higher seeded team has won every time. This is also true when the seed difference is 12, although there have only been 4 games in this scenario. Another oddity is that when the seed difference is 10, the higher seed only has only won 50% of the time. Again, this is largely due to the fact that there have only been 6 games with this seed difference.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">seed.diffs=<a href="http://inside-r.org/r-doc/base/sort"><span style="color: #003399; font-weight: bold;">sort</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/unique"><span style="color: #003399; font-weight: bold;">unique</span></a><span style="color: #009900;">(</span>brackets$SeedDiff<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />win.pct=<a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/mean"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900;">(</span>brackets$HigherSeedWon<span style="color: #009900;">[</span>brackets$SeedDiff==x<span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span>win.pct<span style="color: #009900;">)</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span>win.pct<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+geom_point<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+<br />  geom_hline<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0.5</span><span style="color: #339933;">,</span>linetype=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Proportion of Games Won by Higher Seed"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-4FoTKgiyX10/UXLrF8YV2tI/AAAAAAAAHtU/jgQ3FfibzQg/s1600/Frequencies.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-4FoTKgiyX10/UXLrF8YV2tI/AAAAAAAAHtU/jgQ3FfibzQg/s1600/Frequencies.jpeg" /></a></div><br /><h3>Use Score Difference</h3>In many applications, it has been shown that using margin of victory is much more reliable than just wins and losses. For example, in the computer ranking of College Football teams, using score differences is more accurate, but outlawed for fear that teams would run up the score on weaker opponents. So the computer rankings are not as strong as they could be.<br /><br />We have no such conflict of interest, so we should try to make use of any information available. A simple way to do that is to look at the mean and standard deviation of the margin of victory when the 16 seed is playing the 1 seed. Below is a plot of the mean score difference with a ribbon for the +/- 2 standard deviations.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">seed.diffs=<a href="http://inside-r.org/r-doc/base/sort"><span style="color: #003399; font-weight: bold;">sort</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/unique"><span style="color: #003399; font-weight: bold;">unique</span></a><span style="color: #009900;">(</span>brackets$SeedDiff<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />means=<a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/mean"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900;">(</span>brackets$HigherSeedScoreDiff<span style="color: #009900;">[</span>brackets$SeedDiff==x<span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />sds=<a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/stats/sd"><span style="color: #003399; font-weight: bold;">sd</span></a><span style="color: #009900;">(</span>brackets$HigherSeedScoreDiff<span style="color: #009900;">[</span>brackets$SeedDiff==x<span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span>means<span style="color: #339933;">,</span>sds<span style="color: #009900;">)</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span>means<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  geom_ribbon<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>ymin=means-<span style="color: #cc66cc;">2</span>*sds<span style="color: #339933;">,</span>ymax=means+<span style="color: #cc66cc;">2</span>*sds<span style="color: #009900;">)</span><span style="color: #339933;">,</span>alpha=<span style="color: #cc66cc;">.5</span><span style="color: #009900;">)</span>+geom_point<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+geom_line<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+<br />  geom_hline<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>linetype=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Margin of Victory by Higher Seed"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-4VaSHpRws2A/UXLrGMODjhI/AAAAAAAAHtQ/7JrGAbDYY4A/s1600/MarginOfVictory.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-4VaSHpRws2A/UXLrGMODjhI/AAAAAAAAHtQ/7JrGAbDYY4A/s1600/MarginOfVictory.jpeg" /></a></div><br /><br />You can see that the ribbon includes zero for all seed differences except 15. If we assume that the score differences are roughly normal, we can calculate the probability that the score difference will be greater than 0. The results are largely the same as before, but we see now that there are no 100% estimates. Also, the 50% win percentage for a seed difference of 10 now looks a little more reasonable, albeit still out of line with the rest.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span>means<span style="color: #339933;">,</span>sds<span style="color: #009900;">)</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>seed.diffs<span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span>-<a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>means<span style="color: #339933;">,</span>sds<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  geom_point<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+geom_line<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+geom_hline<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0.5</span><span style="color: #339933;">,</span>linetype=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Probability of Higher Seed Winning Based on Margin of Victory"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-0IRgSQFoL9M/UXLrF7iNsYI/AAAAAAAAHtM/G-7h8k1yLAA/s1600/ProbMarginOfVictory.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-0IRgSQFoL9M/UXLrF7iNsYI/AAAAAAAAHtM/G-7h8k1yLAA/s1600/ProbMarginOfVictory.jpeg" /></a></div><br /><h3>Model Win Percentage as a Function of&nbsp; Seed Difference</h3>It is always good to incorporate as much knowledge as possible into an analysis. In this case, we have information on other games besides the 16 versus 1 seed game which help us estimate the 16 versus 1 game. For example, it is reasonable to assume that the larger the difference in seed is, the more likely the higher seed will win. We can build a logistic regression model which looks at all of the outcomes of all of the games and predicts the probability of winning based on the difference in seed. When the two teams have the same seed, I enforced the probability of the higher seed winning to be 0.5 by making the intercept 0.<br /><br />In the plot below, you can see that the logistic model predicts that the probability of winning increases throughout until reaching about 90% for the 16 versus 1. I also included a non-linear generalized additive model (GAM) model for comparison. The GAM believes that being a big favorite (16 vs 1 or 15 vs 2) gives an little boost in win probability. An advantage of modeling is that we can make predictions for match-ups that have never occurred (like a seed difference of 14). <br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=brackets<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>SeedDiff<span style="color: #339933;">,</span>HigherSeedWon<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  stat_smooth<span style="color: #009900;">(</span>method=<span style="color: blue;">"gam"</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<span style="color: blue;">"binomial"</span><span style="color: #339933;">,</span>se=F<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/formula"><span style="color: #003399; font-weight: bold;">formula</span></a>=y~<span style="color: #cc66cc;">0</span>+x<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>colour=<span style="color: blue;">"Logistic"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  stat_smooth<span style="color: #009900;">(</span>method=<span style="color: blue;">"gam"</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<span style="color: blue;">"binomial"</span><span style="color: #339933;">,</span>se=F<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/formula"><span style="color: #003399; font-weight: bold;">formula</span></a>=y~<a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399; font-weight: bold;">s</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>colour=<span style="color: blue;">"GAM"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_jitter<span style="color: #009900;">(</span>alpha=<span style="color: #cc66cc;">.15</span><span style="color: #339933;">,</span>position = position_jitter<span style="color: #009900;">(</span>height = <span style="color: #cc66cc;">.025</span><span style="color: #339933;">,</span>width=<span style="color: #cc66cc;">.25</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Game Won by Higher Seed"</span><span style="color: #339933;">,</span>colour=<span style="color: blue;">"Model"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-QYWl4914Phc/UXLwH3ls3mI/AAAAAAAAHtY/7CMeKo0ZH5M/s1600/Model01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-QYWl4914Phc/UXLwH3ls3mI/AAAAAAAAHtY/7CMeKo0ZH5M/s1600/Model01.jpeg" /></a></div><br /><h3>Model Score Difference as a Function of&nbsp; Seed Difference</h3>We can also do the same thing with margin of victory. Here, I constrain the linear model to have an intercept of 0, meaning that two teams with the same seed should be evenly matched. Again, I included the GAM fit for comparison. The interpretations are similar to before, in that it seems that there is an increase in margin of victory for the heavily favored teams.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=brackets<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>SeedDiff<span style="color: #339933;">,</span>HigherSeedScoreDiff<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  stat_smooth<span style="color: #009900;">(</span>method=<span style="color: blue;">"lm"</span><span style="color: #339933;">,</span>se=F<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/formula"><span style="color: #003399; font-weight: bold;">formula</span></a>=y~<span style="color: #cc66cc;">0</span>+x<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>colour=<span style="color: blue;">"Linear"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  stat_smooth<span style="color: #009900;">(</span>method=<span style="color: blue;">"gam"</span><span style="color: #339933;">,</span>se=F<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/formula"><span style="color: #003399; font-weight: bold;">formula</span></a>=y~<a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399; font-weight: bold;">s</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>colour=<span style="color: blue;">"GAM"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_jitter<span style="color: #009900;">(</span>alpha=<span style="color: #cc66cc;">.25</span><span style="color: #339933;">,</span>position = position_jitter<span style="color: #009900;">(</span>height = <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>width=<span style="color: #cc66cc;">.25</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Margin of Victory by Higher Seed"</span><span style="color: #339933;">,</span>colour=<span style="color: blue;">"Model"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-ncQ9W4oFjU8/UXLyGTZLNuI/AAAAAAAAHtg/5MqlA6ZbX8c/s1600/ModelDiff.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-ncQ9W4oFjU8/UXLyGTZLNuI/AAAAAAAAHtg/5MqlA6ZbX8c/s1600/ModelDiff.jpeg" /></a></div><br />From these models of margin of victory we can infer the probability of the higher seed winning (again, assuming normality).<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/mgcv/gam"><span style="color: #003399; font-weight: bold;">gam</span></a><span style="color: #009900;">)</span><br />lm.seed=<a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">(</span>HigherSeedScoreDiff~<span style="color: #cc66cc;">0</span>+SeedDiff<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=brackets<span style="color: #009900;">)</span><br />gam.seed=<a href="http://inside-r.org/r-doc/mgcv/gam"><span style="color: #003399; font-weight: bold;">gam</span></a><span style="color: #009900;">(</span>HigherSeedScoreDiff~<a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399; font-weight: bold;">s</span></a><span style="color: #009900;">(</span>SeedDiff<span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=brackets<span style="color: #009900;">)</span><br />&nbsp;<br />pred.lm.seed=<a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">(</span>lm.seed<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=<span style="color: #cc66cc;">0</span>:<span style="color: #cc66cc;">15</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>se.fit=<span style="color: black; font-weight: bold;">TRUE</span><span style="color: #009900;">)</span><br />pred.gam.seed=<a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">(</span>gam.seed<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=<span style="color: #cc66cc;">0</span>:<span style="color: #cc66cc;">15</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>se.fit=<span style="color: black; font-weight: bold;">TRUE</span><span style="color: #009900;">)</span><br />se.lm=<a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/mean"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900;">(</span>lm.seed$residuals^<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />se.gam=<a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/mean"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900;">(</span>gam.seed$residuals^<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />&nbsp;<br />df1=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=<span style="color: #cc66cc;">0</span>:<span style="color: #cc66cc;">15</span><span style="color: #339933;">,</span>ProbLM=<span style="color: #cc66cc;">1</span>-<a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>pred.lm.seed$fit<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span>se.lm^<span style="color: #cc66cc;">2</span>+pred.lm.seed$se.fit^<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />               ProbGAM=<span style="color: #cc66cc;">1</span>-<a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>pred.gam.seed$fit<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span>se.gam^<span style="color: #cc66cc;">2</span>+pred.gam.seed$se.fit^<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>df1<span style="color: #009900;">)</span>+geom_hline<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0.5</span><span style="color: #339933;">,</span>linetype=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>SeedDiff<span style="color: #339933;">,</span>ProbLM<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Linear"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>SeedDiff<span style="color: #339933;">,</span>ProbGAM<span style="color: #339933;">,</span>colour=<span style="color: blue;">"GAM"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Probability of Higher Seed Winning"</span><span style="color: #339933;">,</span>colour=<span style="color: blue;">"Model"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-ZI7n4agC0J8/UXL4fH2dTzI/AAAAAAAAHts/6ia23BR7e7w/s1600/ModelDiffProbs.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-ZI7n4agC0J8/UXL4fH2dTzI/AAAAAAAAHts/6ia23BR7e7w/s1600/ModelDiffProbs.jpeg" /></a></div><br /><h3>Summary</h3>Putting all of the estimates together, you can easily spot the differences between the models. The two assumptions that just used the data between specific seeds look pretty similar. It looks like using score differential is a little more reasonable of the two. The two GAMs have a similar trend and so did the&nbsp; linear and logistic models. If someone asks you what the probability that a 16 seed beats a 1 seed, you have at least 6 different answers.<br /><br />This post highlights the many different ways someone can analyze the same data. Simply statistics talked a bit about this in a <a href="http://simplystatistics.org/2013/04/19/podcast-7-reinhart-rogoff-reproducibility/">recent podcast</a>. In this case, the differences are not huge, but there are noticeable changes. So the next time you read about an analysis that someone did, keep in mind all the decisions that they had to make and what type a sensitivity they would have on the results.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">logit.seed=<a href="http://inside-r.org/r-doc/stats/glm"><span style="color: #003399; font-weight: bold;">glm</span></a><span style="color: #009900;">(</span>HigherSeedWon~<span style="color: #cc66cc;">0</span>+SeedDiff<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=brackets<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<a href="http://inside-r.org/r-doc/stats/binomial"><span style="color: #003399; font-weight: bold;">binomial</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/boot/logit"><span style="color: #003399; font-weight: bold;">logit</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />logit.seed.gam=<a href="http://inside-r.org/r-doc/mgcv/gam"><span style="color: #003399; font-weight: bold;">gam</span></a><span style="color: #009900;">(</span>HigherSeedWon~<a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399; font-weight: bold;">s</span></a><span style="color: #009900;">(</span>SeedDiff<span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=brackets<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399; font-weight: bold;">family</span></a>=<a href="http://inside-r.org/r-doc/stats/binomial"><span style="color: #003399; font-weight: bold;">binomial</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/boot/logit"><span style="color: #003399; font-weight: bold;">logit</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />&nbsp;<br />df2=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=<span style="color: #cc66cc;">0</span>:<span style="color: #cc66cc;">15</span><span style="color: #339933;">,</span><br />               ProbLM=<span style="color: #cc66cc;">1</span>-<a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>pred.lm.seed$fit<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span>se.lm^<span style="color: #cc66cc;">2</span>+pred.lm.seed$se.fit^<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />               ProbGAM=<span style="color: #cc66cc;">1</span>-<a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>pred.gam.seed$fit<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span>se.gam^<span style="color: #cc66cc;">2</span>+pred.gam.seed$se.fit^<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />               ProbLogit=<a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">(</span>logit.seed<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=<span style="color: #cc66cc;">0</span>:<span style="color: #cc66cc;">15</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>type=<span style="color: blue;">"response"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />               ProbLogitGAM=<a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">(</span>logit.seed.gam<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=<span style="color: #cc66cc;">0</span>:<span style="color: #cc66cc;">15</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>type=<span style="color: blue;">"response"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />df2=<a href="http://inside-r.org/r-doc/base/merge"><span style="color: #003399; font-weight: bold;">merge</span></a><span style="color: #009900;">(</span>df2<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=seed.diffs<span style="color: #339933;">,</span>ProbFreq=win.pct<span style="color: #009900;">)</span><span style="color: #339933;">,</span>all.x=T<span style="color: #009900;">)</span><br />df2=<a href="http://inside-r.org/r-doc/base/merge"><span style="color: #003399; font-weight: bold;">merge</span></a><span style="color: #009900;">(</span>df2<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>SeedDiff=seed.diffs<span style="color: #339933;">,</span>ProbScore=<span style="color: #cc66cc;">1</span>-<a href="http://inside-r.org/r-doc/stats/pnorm"><span style="color: #003399; font-weight: bold;">pnorm</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>means<span style="color: #339933;">,</span>sds<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>all.x=T<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>df2<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>SeedDiff<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+geom_hline<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0.5</span><span style="color: #339933;">,</span>linetype=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbLM<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Linear"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbGAM<span style="color: #339933;">,</span>colour=<span style="color: blue;">"GAM"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbLogit<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Logistic"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbLogitGAM<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Logistic GAM"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbFreq<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Frequencies"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbScore<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Score Diff"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  geom_point<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbFreq<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Frequencies"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">3</span><span style="color: #009900;">)</span>+<br />  geom_point<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>y=ProbScore<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Score Diff"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">3</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Seed Difference"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Probability of Higher Seed Winning"</span><span style="color: #339933;">,</span>colour=<span style="color: blue;">"Model"</span><span style="color: #009900;">)</span><br />&nbsp;<br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>df2<span style="color: #009900;">)</span>+geom_hline<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0.5</span><span style="color: #339933;">,</span>linetype=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+<br />  geom_point<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>x=SeedDiff<span style="color: #339933;">,</span>y=ProbFreq<span style="color: #339933;">,</span>colour=<span style="color: blue;">"Frequencies"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-hLA30tdetII/UXL4fBT844I/AAAAAAAAHtw/hZiyPKG1o_g/s1600/AllProbs.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-hLA30tdetII/UXL4fBT844I/AAAAAAAAHtw/hZiyPKG1o_g/s1600/AllProbs.jpeg" /></a></div><br /><i>Note that the GAM functions did not have a way to easily restrict the win probability be equal to exactly 0.5 when the seed difference is 0. That is why you may notice the GAM model is a bit above 0.5 at 0.</i></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Text Decryption Using MCMC]]></title>
    <link href="http://andland.github.io/blog/2013/01/23/text-decryption-using-mcmc/"/>
    <updated>2013-01-23T00:00:00-05:00</updated>
    <id>http://andland.github.io/blog/2013/01/23/text-decryption-using-mcmc</id>
    <content type="html"><![CDATA[<div class='post'>
The famous probabilist and statistician Persi Diaconis wrote an article not too long ago about the "<a href="http://math.uchicago.edu/~shmuel/Network-course-readings/MCMCRev.pdf" target="_blank">Markov chain Monte Carlo (MCMC) Revolution</a>." The paper describes how we are able to solve a diverse set of problems with MCMC. The first example he gives is a text decryption problem solved with a simple Metropolis Hastings sampler.<br /><br />I was always stumped by those <a href="https://en.wikipedia.org/wiki/Cryptogram" target="_blank">cryptograms</a> in the newspaper and thought it would be pretty cool if I could crack them with statistics. So I decided to try it out on my own. The example Diaconis gives is fleshed out in more details by its original authors in its own <a href="http://probability.ca/jeff/ftpdir/decipherart.pdf" target="_blank">article</a>. <br /><br />The decryption I will be attempting is called <a href="https://en.wikipedia.org/wiki/Substitution_cipher" target="_blank">substitution cipher</a>, where each letter of the alphabet corresponds to another letter (possibly the same one). This is the rule that you must follow for the cryptogram game too. There are 26! = 4e26 possible mappings of the letters of the alphabet to one another. This seems like a hopeless problem to solve, but I will show you that a relatively simple solution can be found as long as your reference text is large enough and the text you are trying to decipher is also large enough.<br /><br />The strategy is to use a reference text to create transition probabilities from each letter to the next. This can be stored in a 26 by 26 matrix, where the ith row and jth column is the probability of the jth letter, given the ith letter preceded it. For example, the given the previous letter was a Q, U almost always follows it, so the Q-row and U-column would be close to probability of 1. Assuming these one step transition probabilities are what matter, the likelihood of any mapping is the product of the transition probabilities observed.<br /><br />To create a transition matrix, I downloaded <i>War and Peace </i>from <a href="http://www.gutenberg.org/dirs/2/6/0/2600/2600.txt" target="_blank">Project Gutenberg</a>. I looped through each letter and kept track of the number of number of times each letter followed the previous. I also kept track of a 27th character, which was anything that was not a letter -- for example periods, commas, spaces, etc. This lets me know which letters are more likely to start a word or end a word. Consecutive entries of these special characters are not considered.<br /><br />After I have these counts, I normalize by dividing by the row total. Before normalizing, I add 1 to each cell so that there are no probabilities of 0. This also corresponds to prior information of each transition being equally likely. I could have tried to give more informative prior information (like Q to U being likely), but it would have been difficult and probably inaccurate for the whole matrix.<br /><br />Below is the code for creating the transition probability matrix. Note that I loop through each line and within each line I loop through each character.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">reference=<a href="http://inside-r.org/r-doc/base/readLines"><span style="color: #003399; font-weight: bold;">readLines</span></a><span style="color: #009900;">(</span><span style="color: blue;">"warandpeace.txt"</span><span style="color: #009900;">)</span><br />reference=<a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span>reference<span style="color: #009900;">)</span><br />&nbsp;<br />trans.mat=<a href="http://inside-r.org/r-doc/base/matrix"><span style="color: #003399; font-weight: bold;">matrix</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>=<a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: blue;">""</span><span style="color: #009900;">)</span><br />lastletter=<span style="color: blue;">""</span><br /><span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span>ln <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span>:<a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">(</span>reference<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>ln %% <span style="color: #cc66cc;">1000</span> ==<span style="color: #cc66cc;">0</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><a href="http://inside-r.org/r-doc/base/cat"><span style="color: #003399; font-weight: bold;">cat</span></a><span style="color: #009900;">(</span><span style="color: blue;">"Line"</span><span style="color: #339933;">,</span>ln<span style="color: #339933;">,</span><span style="color: blue;">"<span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #009900;">}</span><br />  <span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span>pos <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span>:<a href="http://inside-r.org/r-doc/base/nchar"><span style="color: #003399; font-weight: bold;">nchar</span></a><span style="color: #009900;">(</span>reference<span style="color: #009900;">[</span>ln<span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    curletter=<a href="http://inside-r.org/r-doc/base/substring"><span style="color: #003399; font-weight: bold;">substring</span></a><span style="color: #009900;">(</span>reference<span style="color: #009900;">[</span>ln<span style="color: #009900;">]</span><span style="color: #339933;">,</span>pos<span style="color: #339933;">,</span>pos<span style="color: #009900;">)</span><br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>curletter %in% <a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />      trans.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><br />                <a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==curletter<span style="color: #009900;">]</span>=<br />        trans.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><br />                  <a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==curletter<span style="color: #009900;">]</span>+<span style="color: #cc66cc;">1</span><br />      lastletter=curletter<br />    <span style="color: #009900;">}</span> <span style="color: black; font-weight: bold;">else</span> <span style="color: #009900;">{</span><br />      <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>lastletter!=<span style="color: blue;">""</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />        trans.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">]</span>=<br />          trans.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">]</span>+<span style="color: #cc66cc;">1</span><br />        lastletter=<span style="color: blue;">""</span><br />      <span style="color: #009900;">}</span><br />    <span style="color: #009900;">}</span><br />  <span style="color: #009900;">}</span><br />  curletter=<span style="color: blue;">""</span><br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>lastletter!=<span style="color: blue;">""</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    trans.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">]</span>=<br />      trans.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">]</span>+<span style="color: #cc66cc;">1</span><br />  <span style="color: #009900;">}</span><br />  lastletter=<span style="color: blue;">""</span><br /><span style="color: #009900;">}</span><br />&nbsp;<br />trans.prob.mat=<a href="http://inside-r.org/r-doc/base/sweep"><span style="color: #003399; font-weight: bold;">sweep</span></a><span style="color: #009900;">(</span>trans.mat+<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/rowSums"><span style="color: #003399; font-weight: bold;">rowSums</span></a><span style="color: #009900;">(</span>trans.mat+<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>FUN=<span style="color: blue;">"/"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><br />I like to visualize my data to make sure everything looks correct. Below is a plot of the transition matrix.&nbsp; The blank space corresponds to non-letter character. A lot of insights can be garnered from this plot. The Q-U relationship pops out. T is the most likely letter to start a word. E is a popular letter to follow many others. Y is likely to end a word.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>melt<span style="color: #009900;">(</span>trans.prob.mat<span style="color: #009900;">)</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>Var2<span style="color: #339933;">,</span>Var1<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+geom_tile<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>fill=value<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  scale_fill_gradient<span style="color: #009900;">(</span>low=<span style="color: blue;">"white"</span><span style="color: #339933;">,</span>high=<span style="color: blue;">"black"</span><span style="color: #339933;">,</span>limits=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Probability of Second Letter"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Conditioning on First Letter"</span><span style="color: #339933;">,</span>fill=<span style="color: blue;">"Prob"</span><span style="color: #009900;">)</span>+<br />  scale_y_discrete<span style="color: #009900;">(</span>limits = <a href="http://inside-r.org/r-doc/base/rev"><span style="color: #003399; font-weight: bold;">rev</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399; font-weight: bold;">levels</span></a><span style="color: #009900;">(</span>melt<span style="color: #009900;">(</span>trans.prob.mat<span style="color: #009900;">)</span>$Var1<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />  coord_equal<span style="color: #009900;">(</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-rOSjww2Z0q0/UPlrNU1mO2I/AAAAAAAAHqM/NizWxWZ8K88/s1600/trans.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://lh3.ggpht.com/-rOSjww2Z0q0/UPlrNU1mO2I/AAAAAAAAHqM/NizWxWZ8K88/s1600/trans.jpeg" /></a></div><div class="separator" style="clear: both; text-align: center;"></div><br />The desired solution will be the one that gives the highest likelihood. This is an <a href="https://en.wikipedia.org/wiki/NP-hard" target="_blank">NP-hard</a> problem so the only way to find the solution is to try all 26! combinations of mappings, which is infeasible, and report the one with the highest likelihood.<br /><br />With the MCMC approach you start with a random mapping of letters. Next you propose a new mapping by randomly switching 2 of the characters in the mapping. So if A mapped to G and L mapped to Z and you switched those two, A would map to Z and L would map to G. With this new mapping, you measure the likelihood and divide it by the likelihood of the previous mapping. If this ratio is greater than 1, then move to this new mapping. If the ratio is less than 1, meaning the new mapping is less likely, then move to this new mapping with a probability equal to the ratio. (Practically, this is done by drawing a random uniform number between 0 and 1 and moving to the proposed mapping if the uniform number is less than the ratio.) Repeat this process until you think you have found a solution.<br /><br />To do this, I first wrote a few functions. One to decode the coded text based on the mapping. The other was to calculate the log likelihood of the decoded text.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">decode &lt;- <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>mapping<span style="color: #339933;">,</span>coded<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />  coded=<a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span>coded<span style="color: #009900;">)</span><br />  decoded=coded<br />  <span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span>i <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span>:<a href="http://inside-r.org/r-doc/base/nchar"><span style="color: #003399; font-weight: bold;">nchar</span></a><span style="color: #009900;">(</span>coded<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/substring"><span style="color: #003399; font-weight: bold;">substring</span></a><span style="color: #009900;">(</span>coded<span style="color: #339933;">,</span>i<span style="color: #339933;">,</span>i<span style="color: #009900;">)</span> %in% <a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />      <a href="http://inside-r.org/r-doc/base/substring"><span style="color: #003399; font-weight: bold;">substring</span></a><span style="color: #009900;">(</span>decoded<span style="color: #339933;">,</span>i<span style="color: #339933;">,</span>i<span style="color: #009900;">)</span>=<a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">[</span>mapping==<a href="http://inside-r.org/r-doc/base/substring"><span style="color: #003399; font-weight: bold;">substring</span></a><span style="color: #009900;">(</span>coded<span style="color: #339933;">,</span>i<span style="color: #339933;">,</span>i<span style="color: #009900;">)</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />    <span style="color: #009900;">}</span><br />  <span style="color: #009900;">}</span><br />  decoded<br /><span style="color: #009900;">}</span><br />&nbsp;<br />&nbsp;<br />log.prob &lt;- <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>mapping<span style="color: #339933;">,</span>decoded<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />  logprob=<span style="color: #cc66cc;">0</span><br />&nbsp;<br />  lastletter=<span style="color: blue;">""</span><br />  <span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span>i <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span>:<a href="http://inside-r.org/r-doc/base/nchar"><span style="color: #003399; font-weight: bold;">nchar</span></a><span style="color: #009900;">(</span>decoded<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    curletter=<a href="http://inside-r.org/r-doc/base/substring"><span style="color: #003399; font-weight: bold;">substring</span></a><span style="color: #009900;">(</span>decoded<span style="color: #339933;">,</span>i<span style="color: #339933;">,</span>i<span style="color: #009900;">)</span><br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>curletter %in% <a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />      logprob=logprob+<a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">(</span>trans.prob.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><br />                                         <a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==curletter<span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />      lastletter=curletter<br />    <span style="color: #009900;">}</span> <span style="color: black; font-weight: bold;">else</span> <span style="color: #009900;">{</span><br />      <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>lastletter!=<span style="color: blue;">""</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />        logprob=logprob+<a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">(</span>trans.prob.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />        lastletter=<span style="color: blue;">""</span><br />      <span style="color: #009900;">}</span><br />    <span style="color: #009900;">}</span><br />  <span style="color: #009900;">}</span><br />&nbsp;<br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>lastletter!=<span style="color: blue;">""</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    logprob=logprob+<a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">(</span>trans.prob.mat<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>trans.mat<span style="color: #009900;">)</span>==lastletter<span style="color: #339933;">,</span><span style="color: #cc66cc;">27</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />    lastletter=<span style="color: blue;">""</span><br />  <span style="color: #009900;">}</span><br />  logprob<br /><span style="color: #009900;">}</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br />To show how this works, I will use the same Shakespeare text that is used in the MCMC Revolution paper. I let it run until it tries out 2000 different mappings (not the same as 2000 iterations, because rejected proposals are not counted). Along the way I am keeping track of the most likely mapping visited, and that will be the final estimate. It should be noted that I am only considering the mapping of letters and it is assumed that the special characters are known. For example spaces and periods are assumed to be the same.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">correctTxt=<span style="color: blue;">"ENTER HAMLET HAM TO BE OR NOT TO BE THAT IS THE QUESTION WHETHER TIS NOBLER IN THE MIND TO SUFFER THE SLINGS AND ARROWS OF OUTRAGEOUS FORTUNE OR TO TAKE ARMS AGAINST A SEA OF TROUBLES AND BY OPPOSING END"</span><br />coded=decode<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/sample"><span style="color: #003399; font-weight: bold;">sample</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>correctTxt<span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># randomly scramble the text</span><br />&nbsp;<br />mapping=<a href="http://inside-r.org/r-doc/base/sample"><span style="color: #003399; font-weight: bold;">sample</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/toupper"><span style="color: #003399; font-weight: bold;">toupper</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">letters</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># initialize a random mapping</span><br />i=<span style="color: #cc66cc;">1</span><br />iters=<span style="color: #cc66cc;">2000</span><br />cur.decode=decode<span style="color: #009900;">(</span>mapping<span style="color: #339933;">,</span>coded<span style="color: #009900;">)</span><br />cur.loglike=log.prob<span style="color: #009900;">(</span>mapping<span style="color: #339933;">,</span>cur.decode<span style="color: #009900;">)</span><br />max.loglike=cur.loglike<br />max.decode=cur.decode<br /><span style="color: black; font-weight: bold;">while</span> <span style="color: #009900;">(</span>i&lt;=iters<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />  proposal=<a href="http://inside-r.org/r-doc/base/sample"><span style="color: #003399; font-weight: bold;">sample</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">26</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># select 2 letters to switch</span><br />  prop.mapping=mapping<br />  prop.mapping<span style="color: #009900;">[</span>proposal<span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span>=mapping<span style="color: #009900;">[</span>proposal<span style="color: #009900;">[</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span><br />  prop.mapping<span style="color: #009900;">[</span>proposal<span style="color: #009900;">[</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span>=mapping<span style="color: #009900;">[</span>proposal<span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span><br />&nbsp;<br />  prop.decode=decode<span style="color: #009900;">(</span>prop.mapping<span style="color: #339933;">,</span>coded<span style="color: #009900;">)</span><br />  prop.loglike=log.prob<span style="color: #009900;">(</span>prop.mapping<span style="color: #339933;">,</span>prop.decode<span style="color: #009900;">)</span><br />&nbsp;<br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/runif"><span style="color: #003399; font-weight: bold;">runif</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>&lt;exp<span style="color: #009900;">(</span>prop.loglike-cur.loglike<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    mapping=prop.mapping<br />    cur.decode=prop.decode<br />    cur.loglike=prop.loglike<br />&nbsp;<br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>cur.loglike&gt;max.loglike<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />      max.loglike=cur.loglike<br />      max.decode=cur.decode<br />    <span style="color: #009900;">}</span><br />&nbsp;<br />    <a href="http://inside-r.org/r-doc/base/cat"><span style="color: #003399; font-weight: bold;">cat</span></a><span style="color: #009900;">(</span>i<span style="color: #339933;">,</span>cur.decode<span style="color: #339933;">,</span><span style="color: blue;">"<span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><br />    i=i+<span style="color: #cc66cc;">1</span><br />  <span style="color: #009900;">}</span><br /><span style="color: #009900;">}</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><br />The output of this example is below. You can see that it comes close but it doesn't quite find the correct mapping. I attribute this to the fact that the text I was trying to decode only had 203 characters. In the paper mentioned above, they decoded the whole play. They further say that their methods work just as well if you randomly sample a text snippet 2000 characters long. Obviously my example had well less than this. This is also a problem in trying to solve a cryptogram because those are even smaller than the Hamlet example I used. So unfortunately this simple method cannot be used for that. (Note that I ran the MCMC chain a several times, using different random starting points, until it came reasonably close to the solution. This is something that the authors also suggested doing.)<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-DABUm0zHOa4/UPmFEVqbsWI/AAAAAAAAHqc/UgIi3nx4VTk/s1600/Iters.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://lh3.ggpht.com/-DABUm0zHOa4/UPmFEVqbsWI/AAAAAAAAHqc/UgIi3nx4VTk/s1600/Iters.png" /></a></div><br /><br />I want to also note that I originally used Alice and Wonderland as the reference text. It had more trouble decoding since this book is much smaller than War and Peace, and therefore the transition probabilities were not as good.<br /><br />The MCMC method is a greedy approach in that you are moving to any mapping that increases the likelihood. Greedy methods are not optimal in general because they can get stuck at local modes, especially in high dimensional problems. MCMC avoids this be moving to less likely mappings with some probability, which ensures that it will find the correct solution with enough time.</div>


<h2>Comments</h2>


<div class='comments'>
<div class='comment'>
<div class='author'>Vivek</div>
<div class='content'>
Andrew,<br /><br />This work is cool!<br /><br />I wrote my own substitution cipher decoder using the algorithm described in Stephen Connor&#39;s dissertation as the basis, but I occasionally glanced at your work as well.<br /><br />My code doesn&#39;t work as awesomely as yours, and it is also much slower (possibly because I use 76 versus the 27 characters, reachChar versus readLine), and I use different functions.<br /><br />But I cited your work and copied your idea for the melt matrix, which is ingenious.<br /><br />Thanks so much!<br /><br />Vivek</div>
</div>
<div class='comment'>
<div class='author'>Andrew Landgraf</div>
<div class='content'>
Thanks, Fernando. I knew I could speed it up by treating it as a vector of letters (or integers), but didn&#39;t take the time to figure it out.</div>
</div>
<div class='comment'>
<div class='author'>Fernando</div>
<div class='content'>
Nice work, but the code to get the transition matrix is VERY slow. I manage to make it faster doing the following:<br />1- get the vector of words (using scan() for example).<br />2- For each word, use strsplit(word, NULL)[[1]] and iterate<br />over the characters to populate the matrix.</div>
</div>
<div class='comment'>
<div class='author'>Andrew</div>
<div class='content'>
I have had that issue working on different computers. I think older versions of reshape2 use X# and newer versions use Var#. Or maybe it&#39;s a difference between using the package reshape and reshape2?</div>
</div>
<div class='comment'>
<div class='author'>Pablik</div>
<div class='content'>
Great work! Sometimes I use Persi&#39;s example for teaching MCMC,<br />there are some old matlab code from the original consultancy work,<br />but I never tryed to replicate the example.<br /><br />I got an error at:<br />ggplot(melt(trans.prob.mat),aes(Var2,Var1))+...<br /><br />the melt() function uses X1 and X2:<br />&gt; tmp &lt;- melt(trans.prob.mat)<br />&gt; head(tmp)<br />  X1 X2        value<br />1  A  A 3.893588e-05<br />2  B  A 9.252956e-02<br />...<br />Cheers,<br /><br />Pablo<br /></div>
</div>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Factor Analysis of Baseball's Hall of Fame Voters]]></title>
    <link href="http://andland.github.io/blog/2013/01/09/factor-analysis-of-baseballs-hall-of/"/>
    <updated>2013-01-09T00:00:00-05:00</updated>
    <id>http://andland.github.io/blog/2013/01/09/factor-analysis-of-baseballs-hall-of</id>
    <content type="html"><![CDATA[<div class='post'>
<!-- saved from url=(0014)about:internet --><html><head>  <title>Factor Analysis of Baseball's Hall of Fame Voters</title> <style type="text/css">body, td {    font-family: sans-serif;    background-color: white;    font-size: 12px;    margin: 8px; }  tt, code, pre {    font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace; }  h1 {     font-size:2.2em;  }  h2 {     font-size:1.8em;  }  h3 {     font-size:1.4em;  }  h4 {     font-size:1.0em;  }  h5 {     font-size:0.9em;  }  h6 {     font-size:0.8em;  }  a:visited {    color: rgb(50%, 0%, 50%); }  pre {     margin-top: 0;    max-width: 95%;    border: 1px solid #ccc;    white-space: pre-wrap; }  pre code {    display: block; padding: 0.5em; }  code.r, code.cpp {    background-color: #F8F8F8; }  table, td, th {   border: none; }  blockquote {    color:#666666;    margin:0;    padding-left: 1em;    border-left: 0.5em #EEE solid; }  hr {    height: 0px;    border-bottom: none;    border-top-width: thin;    border-top-style: dotted;    border-top-color: #999999; }  @media print {    * {        background: transparent !important;        color: black !important;        filter:none !important;        -ms-filter: none !important;     }     body {        font-size:12pt;        max-width:100%;     }            a, a:visited {        text-decoration: underline;     }     hr {        visibility: hidden;       page-break-before: always;    }     pre, blockquote {        padding-right: 1em;        page-break-inside: avoid;     }     tr, img {        page-break-inside: avoid;     }     img {        max-width: 100% !important;     }     @page :left {        margin: 15mm 20mm 15mm 10mm;     }          @page :right {        margin: 15mm 10mm 15mm 20mm;     }     p, h2, h3 {        orphans: 3; widows: 3;     }     h2, h3 {        page-break-after: avoid;     } }  </style> <style type="text/css">   pre .operator,    pre .paren {      color: rgb(104, 118, 135)    }     pre .literal {      color: rgb(88, 72, 246)    }     pre .number {      color: rgb(0, 0, 205);    }     pre .comment {      color: rgb(76, 136, 107);    }     pre .keyword {      color: rgb(0, 0, 255);    }     pre .identifier {      color: rgb(0, 0, 0);    }     pre .string {      color: rgb(3, 106, 7);    } </style> <script type="text/javascript">var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}}; hljs.initHighlightingOnLoad(); </script>        <br />Recently, Nate Silver wrote <a href="http://fivethirtyeight.blogs.nytimes.com/2013/01/08/suspicion-of-steroid-use-could-keep-bagwell-and-piazza-out-of-hall/">a post</a> which analyzed how voters who voted for and against Barry Bonds for Baseball's Hall of Fame differed. Not surprisingly, those who voted for Bonds were more likely to vote for other suspected steroids users (like Roger Clemens). This got me thinking that this would make an interesting case study for factor analysis to see if there are latent factors that drive hall of fame voting.<br /><br />The Twitter user @leokitty has kept track of all the known ballots of the voters in a <a href="https://docs.google.com/spreadsheet/ccc?key=0Aqc4QTMoPrdtdDQxaDYzd1lLOGpOdUdrcnNNNWNXa2c&amp;authkey=CPyuwqIJ&amp;authkey=CPyuwqIJ#gid=6">spreadsheet</a>. The spreadsheet is a matrix that has one row for each voter and one column for each player being voted upon. (Players need 75% of the vote to make it to the hall of fame.) I removed all players that had no votes and all voters that had given a partial ballot.<br /><br />(This matrix either has a 1 or a 0 in each entry, corresponding to whether a voter voted for the player or not. Note that this kind of matrix is similar to the data that is analyzed in information retrieval. I will be decomposing the (centered) matrix using singular value decomposition to run the factor analysis. This is the same technique used for latent semantic indexing in information retrieval.)<br /><br />Starting with the analysis, there is a drop off of the variance  after the first 2 factors, which means it might make sense to look only at the first 2 (which is good because I was only planning on doing so).<br /><br /><pre><code class="r">votes = read.csv("HOF votes.csv", row.names = 1, header = TRUE)<br />pca = princomp(votes)<br />screeplot(pca, type = "l", main = "Scree Plot")<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-hLkeU-zL-Ak/UO2Yd0B5z4I/AAAAAAAAHo4/dH27nksEiHM/s1600/unnamed-chunk-2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-hLkeU-zL-Ak/UO2Yd0B5z4I/AAAAAAAAHo4/dH27nksEiHM/s1600/unnamed-chunk-2.png" /></a></div><br />Looking at the loadings, it appears that the first principal component corresponds strongly to steroid users, which Bonds and Clemens having large negative values and other suspected steroid users being on the negative end. The players on the positive end have no steroid suspicions.<br /><br /><pre><code class="r">dotchart(sort(pca$loadings[, 1]), main = "First Principal Component")<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-K6MEN_9PcHs/UO2Yd69LeeI/AAAAAAAAHok/Lcb2apHZdC0/s1600/unnamed-chunk-3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-K6MEN_9PcHs/UO2Yd69LeeI/AAAAAAAAHok/Lcb2apHZdC0/s1600/unnamed-chunk-3.png" /></a></div>The second component isn't as easy to decipher. The players at the negative end seem to players that are preferred by analytically minded analysts (think Moneyball). Raines, Trammell, and Martinez have more support among this group of voters. Morris, however, has less support among these voters and he isn't that far separated from them.<br /><br />There also may be some secondary steroid association in the component as well separating players who have proof of steroid use versus those which have no proof but look like they took steroids. For example, there is no hard evidence that Bagwell or Piazza took steroids, but they were very muscular and hit a lot of home runs, so they are believed to have taken steroids. There is some sort of evidence the top five players of this component did take steroids.<br /><br /><pre><code class="r">dotchart(sort(pca$loadings[, 2]), main = "Second Principal Component")<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-mKFEcj6ISQU/UO2Yd7ZFDQI/AAAAAAAAHoo/ZBwJgKbcLI4/s1600/unnamed-chunk-4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-mKFEcj6ISQU/UO2Yd7ZFDQI/AAAAAAAAHoo/ZBwJgKbcLI4/s1600/unnamed-chunk-4.png" /></a></div><br />Projecting the votes onto two dimensions, we can look at how the voters for Bonds and Clemens split up. You can see there is a strong horizontal split between the voters for and against Bonds/Clemens. There are also 3 voters that voted for Bonds, but not Clemens.<br /><br /><pre><code class="r">ggplot(data.frame(cbind(pca$scores[, 1:2], votes))) + geom_point(aes(Comp.1, <br />    Comp.2, colour = as.factor(Barry.Bonds), shape = as.factor(Roger.Clemens)), <br />    size = 4) + coord_equal() + labs(colour = "Bonds", shape = "Clemens")<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-nQoFe3Gnk4c/UO2YeZBYwkI/AAAAAAAAHos/KftZv63_S6E/s1600/unnamed-chunk-5.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-nQoFe3Gnk4c/UO2YeZBYwkI/AAAAAAAAHos/KftZv63_S6E/s1600/unnamed-chunk-5.png" /></a></div><br />Similarly, I can look at how the voters split up on the issue of steroids by looking at both Bonds and Bagwell. The voters in the upper left do not care about steroid use, but believe that Bagwell wasn't good enough to make it to the hall of fame. The voters in the lower right do care about steroid use, but believe that Bagwell was innocent of any wrongdoing.<br /><br /><pre><code class="r">ggplot(data.frame(cbind(pca$scores[, 1:2], votes))) + geom_point(aes(Comp.1, <br />    Comp.2, colour = as.factor(paste(Roger.Clemens, "/", Jeff.Bagwell))), size = 4) + <br />    geom_hline(aes(0), size = 0.2) + geom_vline(aes(0), size = 0.2) + coord_equal() + <br />    labs(colour = "Bonds / Bagwell")<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-k4AoH_kJlyc/UO2YfOqnS0I/AAAAAAAAHow/mETFQ33dXVI/s1600/unnamed-chunk-6.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-k4AoH_kJlyc/UO2YfOqnS0I/AAAAAAAAHow/mETFQ33dXVI/s1600/unnamed-chunk-6.png" /></a></div><br />We can also look at a similar plot with Schilling instead of Bagwell. The separation here appears to be stronger.<br /><br /><pre><code class="r">ggplot(data.frame(cbind(pca$scores[, 1:2], votes))) + geom_point(aes(Comp.1, <br />    Comp.2, colour = as.factor(paste(Barry.Bonds, "/", Curt.Schilling))), size = 4) + <br />    geom_hline(aes(0), size = 0.2) + geom_vline(aes(0), size = 0.2) + coord_equal() + <br />    labs(colour = "Bonds / Schilling")<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-aSA3fUNxSGY/UO2YftHu8HI/AAAAAAAAHo0/e2Itd9TkE60/s1600/unnamed-chunk-7.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-aSA3fUNxSGY/UO2YftHu8HI/AAAAAAAAHo0/e2Itd9TkE60/s1600/unnamed-chunk-7.png" /></a></div><br />Finally, we can look at a biplot (using code from <a href="http://stackoverflow.com/questions/6578355/plotting-pca-biplot-with-ggplot2">here</a>).<br /><br /><pre><code class="r">PCbiplot &lt;- function(PC = fit, x = "PC1", y = "PC2") {<br />    # PC being a prcomp object<br />    library(grid)<br />    data &lt;- data.frame(obsnames = row.names(PC$x), PC$x)<br />    plot &lt;- ggplot(data, aes_string(x = x, y = y)) + geom_text(alpha = 0.4, <br />        size = 3, aes(label = obsnames))<br />    plot &lt;- plot + geom_hline(aes(0), size = 0.2) + geom_vline(aes(0), size = 0.2)<br />    datapc &lt;- data.frame(varnames = rownames(PC$rotation), PC$rotation)<br />    mult &lt;- min((max(data[, y]) - min(data[, y])/(max(datapc[, y]) - min(datapc[, <br />        y]))), (max(data[, x]) - min(data[, x])/(max(datapc[, x]) - min(datapc[, <br />        x]))))<br />    datapc &lt;- transform(datapc, v1 = 0.7 * mult * (get(x)), v2 = 0.7 * mult * <br />        (get(y)))<br />    plot &lt;- plot + coord_equal() + geom_text(data = datapc, aes(x = v1, y = v2, <br />        label = varnames), size = 5, vjust = 1, color = "red")<br />    plot &lt;- plot + geom_segment(data = datapc, aes(x = 0, y = 0, xend = v1, <br />        yend = v2), arrow = arrow(length = unit(0.2, "cm")), alpha = 0.75, color = "red")<br />    plot<br />}<br /><br />fit &lt;- prcomp(votes, scale = F)<br />PCbiplot(fit)<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-MPuCAW6v_zw/UO2YgMRas1I/AAAAAAAAHpA/pHzLYPdb0k4/s1600/unnamed-chunk-8.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-MPuCAW6v_zw/UO2YgMRas1I/AAAAAAAAHpA/pHzLYPdb0k4/s1600/unnamed-chunk-8.png" /></a></div>I could have also attempted to rotate the factors to make them more interpretable, but they appeared to have easy interpretation as is. Since we were looking at 2-d plots, rotation would not have made a difference in interpreting the plots. It is also common to use a likelihood approach to estimate factors. I chose to use the principal component method because the data are definitely not normal (being 0's and 1's).</head></html></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Random Forest Variable Importance]]></title>
    <link href="http://andland.github.io/blog/2012/07/19/random-forest-variable-importance/"/>
    <updated>2012-07-19T00:00:00-04:00</updated>
    <id>http://andland.github.io/blog/2012/07/19/random-forest-variable-importance</id>
    <content type="html"><![CDATA[<div class='post'>
<a href="http://en.wikipedia.org/wiki/Random_forest">Random</a> <a href="http://www.stat.berkeley.edu/%7Ebreiman/RandomForests/">forests</a>  are great. They are one of the best "black-box" supervised learning methods. If you have lots of data and lots of predictor variables, you can do worse than random forests. They can deal with messy, real data. If there are lots of extraneous predictors, it has no problem. It automatically does a good job of finding interactions as well. There are no assumptions that the response has a linear (or even smooth) relationship with the predictors.<br /><br />As cited in the Wikipedia article, they do lack some interpretability. But what they lack in interpretation, they more than make up for in prediction power, which I believe is much more important than interpretation in most cases. Even though you cannot easily tell how one variable affects the prediction, you can easily create a <i>partial dependence plot</i> which shows how the response will change as you change the predictor. You can also do this for two variables at once to see the interaction of the two.<br /><br />Also helping in the interpretation is that they can output a list of predictor variables that they believe to be important in predicting the outcome. If nothing else, you can subset the data to only include the most "important" variables, and use that with another model. The randomForest package in R has two measures of importance. <a href="http://rss.acs.unt.edu/Rdoc/library/randomForest/html/importance.html">One </a>is "total decrease in node impurities from splitting on the variable, averaged over all trees." I do not know much about this one, and will not talk about it further. The other is based on a <a href="http://en.wikipedia.org/wiki/Resampling_%28statistics%29#Permutation_tests">permutation test</a>. The idea is that if the variable is not important (the null hypothesis), then rearranging the values of that variable will not degrade prediction accuracy. Random forests use out-of-bag (OOB) samples to measure prediction accuracy.<br /><br />In my experience, it does a pretty good job of finding the most important predictors, but it has issues with correlated predictors. For example, I was working on a problem where I was predicting the price that electricity trades. One feature that I knew would be very important was the amount of electricity being used at that same time. But I thought there might also be a relationship between price and the electricity being used a few hours before and after. When I ran the random forest with these variables, the electricity used 1 hour after was found to be more important than the electricity used at the same time. When including the 1 hour after electricity use instead of the current hour electricity use, the cross validation (CV) error increased. Using both did not significantly change the CV error compared to using just current hour. Because the electricity used at the current hour and the hour after are very correlated, it had trouble telling which one was more important. In truth, given the electricity use at the current hour, the electricity use at the hour after did not improve the predictive accuracy.<br /><br />Why does the importance measure give more weight correlated predictors? <a href="http://www.biomedcentral.com/1471-2105/9/307/">Strobl et al.</a> give some intuition behind what is happening and propose a solution. Basically, the permutation test is ill-posed. The permutation test is testing that the variable is independent of the response as well as all other predictors. Since the correlated predictors are obviously not independent, we get high importance scores. They propose a permutation test where you condition on the correlated predictors. This is a little tricky when the correlated predictors are continuous, but you can read the paper for more details.<br /><br />Another way to think of it is that, since each split only considers a subset of the possible variables, a variable that is correlated with an "important" variable may be considered without the "important" variable. This would cause the correlated variable to be selected for the split. The correlated value does hold some predictive value, but only because of the truly important variable, so it is understandable why this procedure would consider it important.<br /><br />I ran a simulation experiment (similar to the one in the paper) to demonstrate the issue. I simulated 5 predictor variables. Only the first one is related to the response, but the second one has a correlation of about 0.7 with the first one. Luckily, Strobl et al. included their version of importance in the package <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">party</span> in <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">R</span>. I compare variable importance from the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">randomForest </span>package and the importance with and without taking correlated predictors into account from the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">party<span style="font-family: inherit;"> </span></span><span style="font-family: inherit;">pac</span>kage.<br /><br /><pre class="brush: r"># simulate the data<br />x1=rnorm(1000)<br />x2=rnorm(1000,x1,1)<br />y=2*x1+rnorm(1000,0,.5)<br />df=data.frame(y,x1,x2,x3=rnorm(1000),x4=rnorm(1000),x5=rnorm(1000))<br /><br /># run the randomForest implementation<br />library(randomForest)<br />rf1 &lt;- randomForest(y~., data=df, mtry=2, ntree=50, importance=TRUE)<br />importance(rf1,type=1)<br /><br /># run the party implementation<br />library(party)<br />cf1 &lt;- cforest(y~.,data=df,control=cforest_unbiased(mtry=2,ntree=50))<br />varimp(cf1)<br />varimp(cf1,conditional=TRUE)<br /></pre><br />For the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">randomForest</span>, the ratio of importance of the the first and second variable is 4.53. For <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">party</span> without accounting for correlation it is 7.35. And accounting for correlation, it is 369.5. The higher ratios are better because it means that the importance of the first variable is more prominent. party's implementation is clearly doing the job.<br /><br />There is a downside. It takes much longer to calculate importance with correlated predictors than without. For the party package in this example, it took 0.39 seconds to run without and 204.34 seconds with. I could not even run the correlated importance on the electricity price example. There might be a research opportunity to get a quicker approximation.<br /><br />Possibly up next: confidence limits for random forest predictions.</div>


<h2>Comments</h2>


<div class='comments'>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
HI Andrew, When i tried to calculate the variable importance, I get the error <br />&quot;Error in model.matrix.default(as.formula(f), data = blocks) : <br />  allocMatrix: too many elements specified&quot;<br /><br />I&#39;m not sure how to deal with it because I have 2 factor levels which I&#39;m predicting with 23 continuous variable predictors (about 2200 data points. I know it&#39;s a lot to work with, but not sure how to get the correct VarImp values with this large data set.<br /><br />I tried increasing the threshold, but it didn&#39;t help. fit.varimp=varimp(fit.cf,threshold=0.8,conditional=TRUE)<br /><br />Do you have any suggestions? Thanks.</div>
</div>
<div class='comment'>
<div class='author'>Andrew Landgraf</div>
<div class='content'>
Unfortunately, I didn&#39;t set the seed. #nexttime</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
you should provide the seed to reproduce your example</div>
</div>
<div class='comment'>
<div class='author'>Andrew</div>
<div class='content'>
It should be able to give you a solution. I have no idea what ramifications this would have on accuracy or variable importance.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
I have microarray data on 30 entries and thought of using RF to identify important response genes. I understand that this is a N&lt;&lt;p type of problems, but will &#39;party&#39; be able to come up with a solution?</div>
</div>
<div class='comment'>
<div class='author'>Andrew</div>
<div class='content'>
The simple answer is using the partialPlot function in the randomForest package for R (http://rgm2.lab.nig.ac.jp/RGM2/func.php?rd_id=randomForest:partialPlot). <br /><br />What it is doing isn&#39;t all that complicated. Say you want a partial dependence plot for the variable X_1. For each value of X_1=x that you want to plot, you take the average of the prediction with X_1=x and the other explanatory variables equal to the n values that they are in the data set. You are trying to average out the other variables.</div>
</div>
<div class='comment'>
<div class='author'>nanounanue</div>
<div class='content'>
Great explanation!<br /><br />I have a question for you: In your text you said:<br /><br />&quot;&quot;&quot;<br /> ... Even though you cannot easily tell how one variable affects the prediction, you can easily create a partial dependence plot which shows how the response will change as you change the predictor. You can also do this for two variables at once to see the interaction of the two.<br />&quot;&quot;&quot;<br /><br />Could you provide, please, an example of how build the partial dependence plot?<br /><br /><br />Thank you for the post and thanks in advance</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Great post!  Thank you.</div>
</div>
</div>

]]></content>
  </entry>
  
</feed>
