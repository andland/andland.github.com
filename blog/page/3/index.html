
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Statistically Significant</title>
  <meta name="author" content="Andrew Landgraf">

  
  <meta name="description" content="Factor Analysis of Baseball&#8217;s Hall of Fame Voters body, td { font-family: sans-serif; background-color: white; font-size: 12px; margin: 8px &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://andland.github.io/blog/page/3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Statistically Significant" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1827475-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>


<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Statistically Significant</a></h1>
  
    <h2>Andrew Landgraf's Blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:andland.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Blog Archives</a></li>
  <li><a href="/projects">Shiny</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/09/factor-analysis-of-baseballs-hall-of/">Factor Analysis of Baseball&#8217;s Hall of Fame Voters</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-09T00:00:00-05:00" pubdate data-updated="true">Jan 9<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/09/factor-analysis-of-baseballs-hall-of/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<!-- saved from url=(0014)about:internet --><html><head>  <title>Factor Analysis of Baseball&#8217;s Hall of Fame Voters</title> <style type="text/css">body, td {    font-family: sans-serif;    background-color: white;    font-size: 12px;    margin: 8px; }  tt, code, pre {    font-family: &#8216;DejaVu Sans Mono&#8217;, &#8216;Droid Sans Mono&#8217;, &#8216;Lucida Console&#8217;, Consolas, Monaco, monospace; }  h1 {     font-size:2.2em;  }  h2 {     font-size:1.8em;  }  h3 {     font-size:1.4em;  }  h4 {     font-size:1.0em;  }  h5 {     font-size:0.9em;  }  h6 {     font-size:0.8em;  }  a:visited {    color: rgb(50%, 0%, 50%); }  pre {     margin-top: 0;    max-width: 95%;    border: 1px solid #ccc;    white-space: pre-wrap; }  pre code {    display: block; padding: 0.5em; }  code.r, code.cpp {    background-color: #F8F8F8; }  table, td, th {   border: none; }  blockquote {    color:#666666;    margin:0;    padding-left: 1em;    border-left: 0.5em #EEE solid; }  hr {    height: 0px;    border-bottom: none;    border-top-width: thin;    border-top-style: dotted;    border-top-color: #999999; }  @media print {    * {        background: transparent !important;        color: black !important;        filter:none !important;        -ms-filter: none !important;     }     body {        font-size:12pt;        max-width:100%;     }            a, a:visited {        text-decoration: underline;     }     hr {        visibility: hidden;       page-break-before: always;    }     pre, blockquote {        padding-right: 1em;        page-break-inside: avoid;     }     tr, img {        page-break-inside: avoid;     }     img {        max-width: 100% !important;     }     @page :left {        margin: 15mm 20mm 15mm 10mm;     }          @page :right {        margin: 15mm 10mm 15mm 20mm;     }     p, h2, h3 {        orphans: 3; widows: 3;     }     h2, h3 {        page-break-after: avoid;     } }  </style> <style type="text/css">   pre .operator,    pre .paren {      color: rgb(104, 118, 135)    }     pre .literal {      color: rgb(88, 72, 246)    }     pre .number {      color: rgb(0, 0, 205);    }     pre .comment {      color: rgb(76, 136, 107);    }     pre .keyword {      color: rgb(0, 0, 255);    }     pre .identifier {      color: rgb(0, 0, 0);    }     pre .string {      color: rgb(3, 106, 7);    } </style> <script type="text/javascript">var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>&#8220;;t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName(&#8220;pre&#8221;);for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|&#92;?|&#92;[|&#92;{|&#92;(|&#92;^|&#92;^=|&#92;||&#92;|=|&#92;|&#92;||~&#8221;;this.ER=&#8221;(?![&#92;s&#92;S])&#8221;;this.BE={b:&#8221;&#92;&#92;.&#8221;,r:0};this.ASM={cN:&#8221;string&#8221;,b:&#8221;&#8217;&#8221;,e:&#8221;&#8217;&#8221;,i:&#8221;&#92;n&#8221;,c:[this.BE],r:0};this.QSM={cN:&#8221;string&#8221;,b:&#8217;&#8221;&#8217;,e:&#8217;&#8221;&#8217;,i:&#8221;&#92;n&#8221;,c:[this.BE],r:0};this.CLCM={cN:&#8221;comment&#8221;,b:&#8221;//&#8221;,e:&#8221;$&#8221;};this.CBLCLM={cN:&#8221;comment&#8221;,b:&#8221;/&#92;*&#8221;,e:&#8221;&#92;*/&#8221;};this.HCM={cN:&#8221;comment&#8221;,b:&#8221;#&#8221;,e:&#8221;$&#8221;};this.NM={cN:&#8221;number&#8221;,b:this.NR,r:0};this.CNM={cN:&#8221;number&#8221;,b:this.CNR,r:0};this.BNM={cN:&#8221;number&#8221;,b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{&#8220;false&#8221;:1,&#8221;int&#8221;:1,&#8221;float&#8221;:1,&#8221;while&#8221;:1,&#8221;private&#8221;:1,&#8221;char&#8221;:1,&#8221;catch&#8221;:1,&#8221;export&#8221;:1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,&#8221;const&#8221;:1,struct:1,&#8221;for&#8221;:1,static_cast:2,union:1,namespace:1,unsigned:1,&#8221;long&#8221;:1,&#8221;throw&#8221;:1,&#8221;volatile&#8221;:2,&#8221;static&#8221;:1,&#8221;protected&#8221;:1,bool:1,template:1,mutable:1,&#8221;if&#8221;:1,&#8221;public&#8221;:1,friend:2,&#8221;do&#8221;:1,&#8221;return&#8221;:1,&#8221;goto&#8221;:1,auto:1,&#8221;void&#8221;:2,&#8221;enum&#8221;:1,&#8221;else&#8221;:1,&#8221;break&#8221;:1,&#8221;new&#8221;:1,extern:1,using:1,&#8221;true&#8221;:1,&#8221;class&#8221;:1,asm:1,&#8221;case&#8221;:1,typeid:1,&#8221;short&#8221;:1,reinterpret_cast:2,&#8221;default&#8221;:1,&#8221;double&#8221;:1,register:1,explicit:1,signed:1,typename:1,&#8221;try&#8221;:1,&#8221;this&#8221;:1,&#8221;switch&#8221;:1,&#8221;continue&#8221;:1,wchar_t:1,inline:1,&#8221;delete&#8221;:1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:&#8221;</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">&#8220;,k:a,r:10,c:[&#8220;self&#8221;]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:&#8221;number&#8221;,b:&#8221;&#92;b0[xX][0-9a-fA-F]+[Li]?&#92;b&#8221;,e:hljs.IMMEDIATE_RE,r:0},{cN:&#8221;number&#8221;,b:&#8221;&#92;b&#92;d+(?:[eE][+&#92;-]?&#92;d*)?L&#92;b&#8221;,e:hljs.IMMEDIATE_RE,r:0},{cN:&#8221;number&#8221;,b:&#8221;&#92;b&#92;d+&#92;.(?!&#92;d)(?:i&#92;b)?&#8221;,e:hljs.IMMEDIATE_RE,r:1},{cN:&#8221;number&#8221;,b:&#8221;&#92;b&#92;d+(?:&#92;.&#92;d*)?(?:[eE][+&#92;-]?&#92;d*)?i?&#92;b&#8221;,e:hljs.IMMEDIATE_RE,r:0},{cN:&#8221;number&#8221;,b:&#8221;&#92;.&#92;d+(?:[eE][+&#92;-]?&#92;d*)?i?&#92;b&#8221;,e:hljs.IMMEDIATE_RE,r:1},{cN:&#8221;keyword&#8221;,b:&#8221;(?:tryCatch|library|setGeneric|setGroupGeneric)&#92;b&#8221;,e:hljs.IMMEDIATE_RE,r:10},{cN:&#8221;keyword&#8221;,b:&#8221;&#92;.&#92;.&#92;.&#8221;,e:hljs.IMMEDIATE_RE,r:10},{cN:&#8221;keyword&#8221;,b:&#8221;&#92;.&#92;.&#92;d+(?![&#92;w.])&#8221;,e:hljs.IMMEDIATE_RE,r:10},{cN:&#8221;keyword&#8221;,b:&#8221;&#92;b(?:function)&#8221;,e:hljs.IMMEDIATE_RE,r:2},{cN:&#8221;keyword&#8221;,b:&#8221;(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)&#92;b&#8221;,e:hljs.IMMEDIATE_RE,r:1},{cN:&#8221;literal&#8221;,b:&#8221;(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)&#92;b&#8221;,e:hljs.IMMEDIATE_RE,r:10},{cN:&#8221;literal&#8221;,b:&#8221;(?:NULL|TRUE|FALSE|T|F|Inf|NaN)&#92;b&#8221;,e:hljs.IMMEDIATE_RE,r:1},{cN:&#8221;identifier&#8221;,b:&#8221;[a-zA-Z.][a-zA-Z0-9._]*&#92;b&#8221;,e:hljs.IMMEDIATE_RE,r:0},{cN:&#8221;operator&#8221;,b:&#8221;<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}}; hljs.initHighlightingOnLoad(); </script>        <br />Recently, Nate Silver wrote <a href="http://fivethirtyeight.blogs.nytimes.com/2013/01/08/suspicion-of-steroid-use-could-keep-bagwell-and-piazza-out-of-hall/">a post</a> which analyzed how voters who voted for and against Barry Bonds for Baseball&#8217;s Hall of Fame differed. Not surprisingly, those who voted for Bonds were more likely to vote for other suspected steroids users (like Roger Clemens). This got me thinking that this would make an interesting case study for factor analysis to see if there are latent factors that drive hall of fame voting.<br /><br />The Twitter user @leokitty has kept track of all the known ballots of the voters in a <a href="https://docs.google.com/spreadsheet/ccc?key=0Aqc4QTMoPrdtdDQxaDYzd1lLOGpOdUdrcnNNNWNXa2c&amp;authkey=CPyuwqIJ&amp;authkey=CPyuwqIJ#gid=6">spreadsheet</a>. The spreadsheet is a matrix that has one row for each voter and one column for each player being voted upon. (Players need 75% of the vote to make it to the hall of fame.) I removed all players that had no votes and all voters that had given a partial ballot.<br /><br />(This matrix either has a 1 or a 0 in each entry, corresponding to whether a voter voted for the player or not. Note that this kind of matrix is similar to the data that is analyzed in information retrieval. I will be decomposing the (centered) matrix using singular value decomposition to run the factor analysis. This is the same technique used for latent semantic indexing in information retrieval.)<br /><br />Starting with the analysis, there is a drop off of the variance  after the first 2 factors, which means it might make sense to look only at the first 2 (which is good because I was only planning on doing so).<br /><br /><pre><code class="r">votes = read.csv("HOF votes.csv", row.names = 1, header = TRUE)<br />pca = princomp(votes)<br />screeplot(pca, type = "l", main = "Scree Plot")<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-hLkeU-zL-Ak/UO2Yd0B5z4I/AAAAAAAAHo4/dH27nksEiHM/s1600/unnamed-chunk-2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-hLkeU-zL-Ak/UO2Yd0B5z4I/AAAAAAAAHo4/dH27nksEiHM/s1600/unnamed-chunk-2.png" /></a></div><br />Looking at the loadings, it appears that the first principal component corresponds strongly to steroid users, which Bonds and Clemens having large negative values and other suspected steroid users being on the negative end. The players on the positive end have no steroid suspicions.<br /><br /><pre><code class="r">dotchart(sort(pca$loadings[, 1]), main = "First Principal Component")<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-K6MEN_9PcHs/UO2Yd69LeeI/AAAAAAAAHok/Lcb2apHZdC0/s1600/unnamed-chunk-3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-K6MEN_9PcHs/UO2Yd69LeeI/AAAAAAAAHok/Lcb2apHZdC0/s1600/unnamed-chunk-3.png" /></a></div>The second component isn&#8217;t as easy to decipher. The players at the negative end seem to players that are preferred by analytically minded analysts (think Moneyball). Raines, Trammell, and Martinez have more support among this group of voters. Morris, however, has less support among these voters and he isn&#8217;t that far separated from them.<br /><br />There also may be some secondary steroid association in the component as well separating players who have proof of steroid use versus those which have no proof but “look like” they took steroids. For example, there is no hard evidence that Bagwell or Piazza took steroids, but they were very muscular and hit a lot of home runs, so they are believed to have taken steroids. There is some sort of evidence the top five players of this component did take steroids.<br /><br /><pre><code class="r">dotchart(sort(pca$loadings[, 2]), main = "Second Principal Component")<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-mKFEcj6ISQU/UO2Yd7ZFDQI/AAAAAAAAHoo/ZBwJgKbcLI4/s1600/unnamed-chunk-4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-mKFEcj6ISQU/UO2Yd7ZFDQI/AAAAAAAAHoo/ZBwJgKbcLI4/s1600/unnamed-chunk-4.png" /></a></div><br />Projecting the votes onto two dimensions, we can look at how the voters for Bonds and Clemens split up. You can see there is a strong horizontal split between the voters for and against Bonds/Clemens. There are also 3 voters that voted for Bonds, but not Clemens.<br /><br /><pre><code class="r">ggplot(data.frame(cbind(pca$scores[, 1:2], votes))) + geom_point(aes(Comp.1, <br />    Comp.2, colour = as.factor(Barry.Bonds), shape = as.factor(Roger.Clemens)), <br />    size = 4) + coord_equal() + labs(colour = "Bonds", shape = "Clemens")<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-nQoFe3Gnk4c/UO2YeZBYwkI/AAAAAAAAHos/KftZv63_S6E/s1600/unnamed-chunk-5.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-nQoFe3Gnk4c/UO2YeZBYwkI/AAAAAAAAHos/KftZv63_S6E/s1600/unnamed-chunk-5.png" /></a></div><br />Similarly, I can look at how the voters split up on the issue of steroids by looking at both Bonds and Bagwell. The voters in the upper left do not care about steroid use, but believe that Bagwell wasn&#8217;t good enough to make it to the hall of fame. The voters in the lower right do care about steroid use, but believe that Bagwell was innocent of any wrongdoing.<br /><br /><pre><code class="r">ggplot(data.frame(cbind(pca$scores[, 1:2], votes))) + geom_point(aes(Comp.1, <br />    Comp.2, colour = as.factor(paste(Roger.Clemens, "/", Jeff.Bagwell))), size = 4) + <br />    geom_hline(aes(0), size = 0.2) + geom_vline(aes(0), size = 0.2) + coord_equal() + <br />    labs(colour = "Bonds / Bagwell")<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-k4AoH_kJlyc/UO2YfOqnS0I/AAAAAAAAHow/mETFQ33dXVI/s1600/unnamed-chunk-6.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-k4AoH_kJlyc/UO2YfOqnS0I/AAAAAAAAHow/mETFQ33dXVI/s1600/unnamed-chunk-6.png" /></a></div><br />We can also look at a similar plot with Schilling instead of Bagwell. The separation here appears to be stronger.<br /><br /><pre><code class="r">ggplot(data.frame(cbind(pca$scores[, 1:2], votes))) + geom_point(aes(Comp.1, <br />    Comp.2, colour = as.factor(paste(Barry.Bonds, "/", Curt.Schilling))), size = 4) + <br />    geom_hline(aes(0), size = 0.2) + geom_vline(aes(0), size = 0.2) + coord_equal() + <br />    labs(colour = "Bonds / Schilling")<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-aSA3fUNxSGY/UO2YftHu8HI/AAAAAAAAHo0/e2Itd9TkE60/s1600/unnamed-chunk-7.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-aSA3fUNxSGY/UO2YftHu8HI/AAAAAAAAHo0/e2Itd9TkE60/s1600/unnamed-chunk-7.png" /></a></div><br />Finally, we can look at a biplot (using code from <a href="http://stackoverflow.com/questions/6578355/plotting-pca-biplot-with-ggplot2">here</a>).<br /><br /><pre><code class="r">PCbiplot &lt;- function(PC = fit, x = "PC1", y = "PC2") {<br />    # PC being a prcomp object<br />    library(grid)<br />    data &lt;- data.frame(obsnames = row.names(PC$x), PC$x)<br />    plot &lt;- ggplot(data, aes_string(x = x, y = y)) + geom_text(alpha = 0.4, <br />        size = 3, aes(label = obsnames))<br />    plot &lt;- plot + geom_hline(aes(0), size = 0.2) + geom_vline(aes(0), size = 0.2)<br />    datapc &lt;- data.frame(varnames = rownames(PC$rotation), PC$rotation)<br />    mult &lt;- min((max(data[, y]) - min(data[, y])/(max(datapc[, y]) - min(datapc[, <br />        y]))), (max(data[, x]) - min(data[, x])/(max(datapc[, x]) - min(datapc[, <br />        x]))))<br />    datapc &lt;- transform(datapc, v1 = 0.7 * mult * (get(x)), v2 = 0.7 * mult * <br />        (get(y)))<br />    plot &lt;- plot + coord_equal() + geom_text(data = datapc, aes(x = v1, y = v2, <br />        label = varnames), size = 5, vjust = 1, color = "red")<br />    plot &lt;- plot + geom_segment(data = datapc, aes(x = 0, y = 0, xend = v1, <br />        yend = v2), arrow = arrow(length = unit(0.2, "cm")), alpha = 0.75, color = "red")<br />    plot<br />}<br /><br />fit &lt;- prcomp(votes, scale = F)<br />PCbiplot(fit)<br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-MPuCAW6v_zw/UO2YgMRas1I/AAAAAAAAHpA/pHzLYPdb0k4/s1600/unnamed-chunk-8.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-MPuCAW6v_zw/UO2YgMRas1I/AAAAAAAAHpA/pHzLYPdb0k4/s1600/unnamed-chunk-8.png" /></a></div>I could have also attempted to rotate the factors to make them more interpretable, but they appeared to have easy interpretation as is. Since we were looking at 2-d plots, rotation would not have made a difference in interpreting the plots. It is also common to use a likelihood approach to estimate factors. I chose to use the principal component method because the data are definitely not normal (being 0&#8217;s and 1&#8217;s).</head></html></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/05/quick-post-about-getting-and-plotting/">Quick Post About Getting and Plotting Polls in R</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-05T00:00:00-05:00" pubdate data-updated="true">Nov 5<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/11/05/quick-post-about-getting-and-plotting/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
With the election nearly upon us, I wanted to share an easy way I just found to download polling data and graph a few with ggplot2. <a href="https://github.com/dlinzer/pollstR/">dlinzer </a>at github created a function to download poll data from the <a href="http://elections.huffingtonpost.com/pollster/api">Huffington Post&#8217;s Pollster API</a>.<br /><br />The default is to download national tracking polls from the presidential election. After sourcing the function, I load the required packages, download the data, and make the plot.<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/XML">XML</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/reshape"><span style="color: #003399; font-weight: bold;">reshape</span></a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><span style="color: #339933;">;</span> theme_set<span style="color: #009900;">(</span>theme_bw<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />&nbsp;<br />dat &lt;- pollstR<span style="color: #009900;">(</span>pages=<span style="color: #cc66cc;">20</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>dat<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>end.date<span style="color: #339933;">,</span>Obama/<span style="color: #009900;">(</span>Obama+Romney<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+geom_point<span style="color: #009900;">(</span>alpha=<span style="color: #cc66cc;">.5</span><span style="color: #009900;">)</span>+geom_smooth<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>weight=<a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span>N<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+geom_hline<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0.5</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>lty=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/graphics/title"><span style="color: #003399; font-weight: bold;">title</span></a>=<span style="color: blue;">"Proportion of Vote for Obama"</span><span style="color: #339933;">,</span>x=<span style="color: blue;">"Last Date of Poll"</span><span style="color: #339933;">,</span>y=<span style="color: black; font-weight: bold;">NULL</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-KXjQJ7sJ0eI/UJhfahhVZCI/AAAAAAAAHW8/nRxJVgXK5Fs/s1600/PollsPlot1.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="512" src="http://4.bp.blogspot.com/-KXjQJ7sJ0eI/UJhfahhVZCI/AAAAAAAAHW8/nRxJVgXK5Fs/s1600/PollsPlot1.jpeg" style="cursor: move;" width="640" /></a></div>I have used transparency so that you can see when there are many polls on top of each other. You can see that Obama&#8217;s lead decreased substantially after the first debate but has crawled back up since then. Of course, I am treating all polls as equal (although I am weighting by sample size) when the truth is that some polls are better than others and some are biased.<br /><br />To have some more fun, I will show what some of the data from swing states look like. The code below loops through the swing states and downloads the polls. Then it plots the polls for each state in different facets.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://4.bp.blogspot.com/-KXjQJ7sJ0eI/UJhfahhVZCI/AAAAAAAAHW8/nRxJVgXK5Fs/s1600/PollsPlot1.jpeg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"></a><a href="http://4.bp.blogspot.com/-KXjQJ7sJ0eI/UJhfahhVZCI/AAAAAAAAHW8/nRxJVgXK5Fs/s1600/PollsPlot1.jpeg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"></a>swing.states=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">"ohio"</span><span style="color: #339933;">,</span><span style="color: blue;">"florida"</span><span style="color: #339933;">,</span><span style="color: blue;">"virginia"</span><span style="color: #339933;">,</span><span style="color: blue;">"colorado"</span><span style="color: #339933;">,</span><span style="color: blue;">"nevada"</span><span style="color: #339933;">,</span><span style="color: blue;">"north-carolina"</span><span style="color: #009900;">)</span><br /><span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399; font-weight: bold;">s</span></a> <span style="color: black; font-weight: bold;">in</span> swing.states<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />  <a href="http://inside-r.org/r-doc/base/print"><span style="color: #003399; font-weight: bold;">print</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399; font-weight: bold;">s</span></a><span style="color: #009900;">)</span><br />  dat.state &lt;- pollstR<span style="color: #009900;">(</span>chart=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">(</span><span style="color: blue;">"2012-"</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399; font-weight: bold;">s</span></a><span style="color: #339933;">,</span><span style="color: blue;">"-president-romney-vs-obama"</span><span style="color: #339933;">,</span>sep=<span style="color: blue;">""</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>pages=<span style="color: blue;">"all"</span><span style="color: #009900;">)</span><br />  dat.state=<a href="http://inside-r.org/r-doc/base/subset"><span style="color: #003399; font-weight: bold;">subset</span></a><span style="color: #009900;">(</span>dat.state<span style="color: #339933;">,</span>select=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">"id"</span><span style="color: #339933;">,</span><span style="color: blue;">"pollster"</span><span style="color: #339933;">,</span><span style="color: blue;">"start.date"</span><span style="color: #339933;">,</span><span style="color: blue;">"end.date"</span><span style="color: #339933;">,</span><span style="color: blue;">"method"</span><span style="color: #339933;">,</span><span style="color: blue;">"N"</span><span style="color: #339933;">,</span><span style="color: blue;">"Obama"</span><span style="color: #339933;">,</span><span style="color: blue;">"Romney"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />  dat.state$State=<a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399; font-weight: bold;">s</span></a><br />&nbsp;<br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399; font-weight: bold;">s</span></a>==<span style="color: blue;">"ohio"</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    dat=dat.state<br />  <span style="color: #009900;">}</span> <span style="color: black; font-weight: bold;">else</span> <span style="color: #009900;">{</span><br />    dat=<a href="http://inside-r.org/r-doc/base/rbind"><span style="color: #003399; font-weight: bold;">rbind</span></a><span style="color: #009900;">(</span>dat<span style="color: #339933;">,</span>dat.state<span style="color: #009900;">)</span><br />  <span style="color: #009900;">}</span><br /><span style="color: #009900;">}</span><br />&nbsp;<br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span>lubridate<span style="color: #009900;">)</span><br />dat$end.date=ymd<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/as.character"><span style="color: #003399; font-weight: bold;">as.character</span></a><span style="color: #009900;">(</span>dat$end.date<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>dat<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>end.date<span style="color: #339933;">,</span>Obama/<span style="color: #009900;">(</span>Obama+Romney<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+geom_point<span style="color: #009900;">(</span>alpha=<span style="color: #cc66cc;">.5</span><span style="color: #009900;">)</span>+geom_smooth<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>weight=<a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span>N<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+geom_hline<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0.5</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>lty=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/graphics/title"><span style="color: #003399; font-weight: bold;">title</span></a>=<span style="color: blue;">"Proportion of Vote for Obama"</span><span style="color: #339933;">,</span>x=<span style="color: blue;">"Last Date of Poll"</span><span style="color: #339933;">,</span>y=<span style="color: black; font-weight: bold;">NULL</span><span style="color: #009900;">)</span>+facet_wrap<span style="color: #009900;">(</span>~State<span style="color: #009900;">)</span>+xlim<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span>mdy<span style="color: #009900;">(</span><span style="color: blue;">"8/1/2012"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>mdy<span style="color: #009900;">(</span><span style="color: blue;">"11/6/2012"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-FwY5UtHzB-4/UJhkl-qrDgI/AAAAAAAAHXM/LzcRBLshLRM/s1600/PollsPlot2.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="512" src="http://2.bp.blogspot.com/-FwY5UtHzB-4/UJhkl-qrDgI/AAAAAAAAHXM/LzcRBLshLRM/s1600/PollsPlot2.jpeg" width="640" /></a></div>Unfortunately the x-axis didn&#8217;t show up very well, but it starts at August 1. There have been quite a few polls in Ohio and Florida, haven&#8217;t there? The state polls did not have nearly the same shift that the national poll did in reaction to the first debate. The state with the largest bump is Colorado, where the debate was held.<br /><a href="http://4.bp.blogspot.com/-KXjQJ7sJ0eI/UJhfahhVZCI/AAAAAAAAHW8/nRxJVgXK5Fs/s1600/PollsPlot1.jpeg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"></a><a href="http://4.bp.blogspot.com/-KXjQJ7sJ0eI/UJhfahhVZCI/AAAAAAAAHW8/nRxJVgXK5Fs/s1600/PollsPlot1.jpeg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"></a><br />By just looking at the tracking polls, I think you would make the same conclusions that <a href="http://fivethirtyeight.blogs.nytimes.com/">Nate Silver</a> has with his fancy model. Ohio, Virginia, Nevada, and Colorado favor Obama. North Carolina favors Romney and Florida just barely tips toward Romney as well.<br /><br />Finally, here are just the smoothed running means, all on one plot. You can see that There was also a first debate effect in Ohio.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>dat<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>end.date<span style="color: #339933;">,</span>Obama/<span style="color: #009900;">(</span>Obama+Romney<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+geom_smooth<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>colour=State<span style="color: #339933;">,</span>weight=<a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span>N<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>se=<span style="color: black; font-weight: bold;">FALSE</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+geom_hline<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>yintercept=<span style="color: #cc66cc;">0.5</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>lty=<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span>+<br />  labs<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/graphics/title"><span style="color: #003399; font-weight: bold;">title</span></a>=<span style="color: blue;">"Proportion of Vote for Obama"</span><span style="color: #339933;">,</span>x=<span style="color: blue;">"Last Date of Poll"</span><span style="color: #339933;">,</span>y=<span style="color: black; font-weight: bold;">NULL</span><span style="color: #009900;">)</span>+xlim<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span>mdy<span style="color: #009900;">(</span><span style="color: blue;">"8/1/2012"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>mdy<span style="color: #009900;">(</span><span style="color: blue;">"11/6/2012"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-nN9GHK_W6Zs/UJhpDsnKArI/AAAAAAAAHXc/RBVNGzoM7tQ/s1600/PollsPlot3.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-nN9GHK_W6Zs/UJhpDsnKArI/AAAAAAAAHXc/RBVNGzoM7tQ/s1600/PollsPlot3.jpeg" height="347" width="640" /></a></div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Andrew Clark</div>
<div class='content'>
Interesting work. Thanks for the tip on the API/github. I have had a look at the GOP campaign - surely one of the strangest in history<br />http://wp.me/p17axt-jK</div>
</div>
<div class='comment'>
<div class='author'>Andrew</div>
<div class='content'>
Thanks for the tip. To add more information to the national tracker plot, you can make the of the points relative to the number polled. Also facet it by the type of poll. Like this:<br /><br />ggplot(dat,aes(end.date,Obama/(Obama+Romney)))+<br />  geom_point(aes(size=sqrt(N)),alpha=.5)+<br />  geom_smooth(aes(weight=sqrt(N)))+<br />  geom_hline(aes(yintercept=0.5),lty=2,size=1)+<br />  labs(title=&quot;Proportion of Vote for Obama&quot;,x=&quot;Last Date of Poll&quot;,y=NULL)+<br />  facet_wrap(~method)+<br />  theme(axis.text.x=element_text(angle=-90))</div>
</div>
<div class='comment'>
<div class='author'>Tony Hirst</div>
<div class='content'>
You can tidy up the x-axis labels by rotating them, eg using something like:<br />+theme(axis.text.x=element_text(angle=-90))</div>
</div>
<div class='comment'>
<div class='author'>Tony Hirst</div>
<div class='content'>
This comment has been removed by the author.</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/24/finding-best-subset-of-gam-using-tabu/">Finding the Best Subset of a GAM Using Tabu Search and Visualizing It in R</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-24T00:00:00-04:00" pubdate data-updated="true">Aug 24<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/24/finding-best-subset-of-gam-using-tabu/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Finding the best subset of variables for a regression is a very common task in statistics and machine learning. There are statistical methods based on asymptotic normal theory that can help you decide whether to add or remove a variable at a time. The problem with this is that it is a greedy approach and you can easily get stuck in a local mode. Another approach is to look at all possible subsets of the variables and see which one maximizes an objective function (accuracy on a test set, for example).<br /><br />Heuristics are required if the number of variables, <i>p</i>, gets large (&gt;40) because the number of possible subsets is equal to 2^<i>p</i>, excluding interactions. One method that works well is called <a href="http://en.wikipedia.org/wiki/Tabu_search">tabu search</a> (TS). It is a more general optimization method, but in the case of finding the best subset, it is similar to stepwise methods. At any point, it will try to improve the objective function the most by adding or removing one variable. One difference is that TS will not add or remove variables that have been recently added or removed. This avoids the optimization from getting stuck at a local maximum. There are more details to the algorithm that you can read up on if you would like.<br /><br />There is a <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">tabuSearch<span style="font-family: Arial,Helvetica,sans-serif;"> </span></span>package in <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">R</span> that implements this algorithm. I wanted to find a best subset regression using generalized additive models (GAMs) of the package <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">mgcv</span>. An issue arose, because you need to specify which terms are smooth and which are not in a formula to use <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">mgcv</span>. The general form of the formula looks like:<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">gam(y ~ s(x1) + s(x2) + x3, data=train)</span><br />where <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">x1</span> and <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">x2</span> are smooth terms and <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">x3</span> is treated like it is in a linear model.<br /><br />My data set has a combination of continuous variables, which I want to treat as smooth, and categorical variables, which I want to treat as factors. For each variable in the subset, I need to identify whether it is a factor or not, and then creating a string of the variable with or without <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">s()</span>. <br /><br />For example, <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">th</span> is a vector of 0&#8217;s and 1&#8217;s which indicate whether each variable (column) is in the regression. I used the housing data set from <a href="http://archive.ics.uci.edu/ml/datasets/Housing">UCI ML repository</a>. With 13 explanatory variables, there are 8192 possible main effects models. I am predicting MEDV, so I start the formula string with &#8220;MEDV ~&#8221;. Then I loop through each element of <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">th</span>. If it is 1 then I want to add it to the formula. I check if it is a factor and if so I just add the name of the variable plus a &#8220;+&#8221;. If it is continuous, I add the column name with &#8221;<span style="font-family: &quot;Courier New&quot;,Courier,monospace;">s()</span>&#8221; around it. Finally I convert the string to a formula using <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">formula()</span>. I can plug in this formula into the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">gam</span> function. <br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">num.cols=<a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">(</span>th<span style="color: #009900;">)</span><br />fo.str=<span style="color: blue;">"MEDV ~"</span><br />cum.cols=<span style="color: #cc66cc;">0</span><br /><span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span>i <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span>:<a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">(</span>th<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>th<span style="color: #009900;">[</span>i<span style="color: #009900;">]</span>&gt;<span style="color: #cc66cc;">0</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/is.factor"><span style="color: #003399; font-weight: bold;">is.factor</span></a><span style="color: #009900;">(</span>train<span style="color: #009900;">[</span><span style="color: #339933;">,</span>i<span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />      fo.str=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">(</span>fo.str<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>train<span style="color: #009900;">)</span><span style="color: #009900;">[</span>i<span style="color: #009900;">]</span><span style="color: #339933;">,</span>sep=<span style="color: blue;">" "</span><span style="color: #009900;">)</span><br />    <span style="color: #009900;">}</span> <span style="color: black; font-weight: bold;">else</span> <span style="color: #009900;">{</span><br />      fo.str=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">(</span>fo.str<span style="color: #339933;">,</span><span style="color: blue;">" s("</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>train<span style="color: #009900;">)</span><span style="color: #009900;">[</span>i<span style="color: #009900;">]</span><span style="color: #339933;">,</span><span style="color: blue;">")"</span><span style="color: #339933;">,</span>sep=<span style="color: blue;">""</span><span style="color: #009900;">)</span><br />    <span style="color: #009900;">}</span><br />    cum.cols=cum.cols+<span style="color: #cc66cc;">1</span><br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>cum.cols&lt;num.cols<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />      fo.str=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">(</span>fo.str<span style="color: #339933;">,</span><span style="color: blue;">"+"</span><span style="color: #009900;">)</span><br />    <span style="color: #009900;">}</span><br />  <span style="color: #009900;">}</span><br /><span style="color: #009900;">}</span><br />fo=<a href="http://inside-r.org/r-doc/stats/as.formula"><span style="color: #003399; font-weight: bold;">as.formula</span></a><span style="color: #009900;">(</span>fo.str<span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br />For evaluating the subsets, I split the data into training, validation, and testing. I trained the subset on the training data set and measured the R-squared on the prediction of the validation set. The full code can be found below.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/mgcv/mgcv"><span style="color: #003399; font-weight: bold;">mgcv</span></a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span>tabuSearch<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># http://archive.ics.uci.edu/ml/datasets/Housing</span><br /><a href="http://inside-r.org/r-doc/MASS/housing"><span style="color: #003399; font-weight: bold;">housing</span></a>=<a href="http://inside-r.org/r-doc/utils/read.table"><span style="color: #003399; font-weight: bold;">read.table</span></a><span style="color: #009900;">(</span><span style="color: blue;">"http://archive.ics.uci.edu/ml/machine-learning-databases/housing/housing.data"</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/MASS/housing"><span style="color: #003399; font-weight: bold;">housing</span></a><span style="color: #009900;">)</span>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">"CRIM"</span><span style="color: #339933;">,</span> <span style="color: blue;">"ZN"</span><span style="color: #339933;">,</span> <span style="color: blue;">"INDUS"</span><span style="color: #339933;">,</span> <span style="color: blue;">"CHAS"</span><span style="color: #339933;">,</span> <span style="color: blue;">"NOX"</span><span style="color: #339933;">,</span> <span style="color: blue;">"RM"</span><span style="color: #339933;">,</span> <span style="color: blue;">"AGE"</span><span style="color: #339933;">,</span> <span style="color: blue;">"DIS"</span><span style="color: #339933;">,</span> <span style="color: blue;">"RAD"</span><span style="color: #339933;">,</span> <span style="color: blue;">"TAX"</span><span style="color: #339933;">,</span> <span style="color: blue;">"PTRATIO"</span><span style="color: #339933;">,</span> <span style="color: blue;">"B"</span><span style="color: #339933;">,</span> <span style="color: blue;">"LSTAT"</span><span style="color: #339933;">,</span> <span style="color: blue;">"MEDV"</span><span style="color: #009900;">)</span><br />&nbsp;<br /><a href="http://inside-r.org/r-doc/MASS/housing"><span style="color: #003399; font-weight: bold;">housing</span></a>$CHAS=<a href="http://inside-r.org/r-doc/base/as.factor"><span style="color: #003399; font-weight: bold;">as.factor</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/MASS/housing"><span style="color: #003399; font-weight: bold;">housing</span></a>$CHAS<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/MASS/housing"><span style="color: #003399; font-weight: bold;">housing</span></a>$RAD=<a href="http://inside-r.org/r-doc/base/as.factor"><span style="color: #003399; font-weight: bold;">as.factor</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/MASS/housing"><span style="color: #003399; font-weight: bold;">housing</span></a>$RAD<span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># Changed to factor bc only 9 unique values</span><br /><a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/MASS/housing"><span style="color: #003399; font-weight: bold;">housing</span></a><span style="color: #009900;">)</span><br />&nbsp;<br /><a href="http://inside-r.org/r-doc/base/set.seed"><span style="color: #003399; font-weight: bold;">set.seed</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">20120823</span><span style="color: #009900;">)</span><br />cv=<a href="http://inside-r.org/r-doc/base/sample"><span style="color: #003399; font-weight: bold;">sample</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/nrow"><span style="color: #003399; font-weight: bold;">nrow</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/MASS/housing"><span style="color: #003399; font-weight: bold;">housing</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />train=<a href="http://inside-r.org/r-doc/MASS/housing"><span style="color: #003399; font-weight: bold;">housing</span></a><span style="color: #009900;">[</span>cv<span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">300</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><br />valid=<a href="http://inside-r.org/r-doc/MASS/housing"><span style="color: #003399; font-weight: bold;">housing</span></a><span style="color: #009900;">[</span>cv<span style="color: #009900;">[</span><span style="color: #cc66cc;">301</span>:<span style="color: #cc66cc;">400</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><br />test=<a href="http://inside-r.org/r-doc/MASS/housing"><span style="color: #003399; font-weight: bold;">housing</span></a><span style="color: #009900;">[</span>cv<span style="color: #009900;">[</span><span style="color: #cc66cc;">401</span>:<a href="http://inside-r.org/r-doc/base/nrow"><span style="color: #003399; font-weight: bold;">nrow</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/MASS/housing"><span style="color: #003399; font-weight: bold;">housing</span></a><span style="color: #009900;">)</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><br />&nbsp;<br />ssto=<a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">(</span><span style="color: #009900;">(</span>valid$MEDV-<a href="http://inside-r.org/r-doc/base/mean"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900;">(</span>valid$MEDV<span style="color: #009900;">)</span><span style="color: #009900;">)</span>^<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><br />evaluate &lt;- <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>th<span style="color: #009900;">)</span><span style="color: #009900;">{</span> <br />  num.cols=<a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">(</span>th<span style="color: #009900;">)</span><br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>num.cols == <span style="color: #cc66cc;">0</span><span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/return"><span style="color: #003399; font-weight: bold;">return</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">)</span><br />  fo.str=<span style="color: blue;">"MEDV ~"</span><br />  cum.cols=<span style="color: #cc66cc;">0</span><br />  <span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span>i <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span>:<a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">(</span>th<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>th<span style="color: #009900;">[</span>i<span style="color: #009900;">]</span>&gt;<span style="color: #cc66cc;">0</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />      <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/is.factor"><span style="color: #003399; font-weight: bold;">is.factor</span></a><span style="color: #009900;">(</span>train<span style="color: #009900;">[</span><span style="color: #339933;">,</span>i<span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />        fo.str=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">(</span>fo.str<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>train<span style="color: #009900;">)</span><span style="color: #009900;">[</span>i<span style="color: #009900;">]</span><span style="color: #339933;">,</span>sep=<span style="color: blue;">" "</span><span style="color: #009900;">)</span><br />      <span style="color: #009900;">}</span> <span style="color: black; font-weight: bold;">else</span> <span style="color: #009900;">{</span><br />        fo.str=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">(</span>fo.str<span style="color: #339933;">,</span><span style="color: blue;">" s("</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>train<span style="color: #009900;">)</span><span style="color: #009900;">[</span>i<span style="color: #009900;">]</span><span style="color: #339933;">,</span><span style="color: blue;">")"</span><span style="color: #339933;">,</span>sep=<span style="color: blue;">""</span><span style="color: #009900;">)</span><br />      <span style="color: #009900;">}</span><br />      cum.cols=cum.cols+<span style="color: #cc66cc;">1</span><br />      <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>cum.cols&lt;num.cols<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />        fo.str=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">(</span>fo.str<span style="color: #339933;">,</span><span style="color: blue;">"+"</span><span style="color: #009900;">)</span><br />      <span style="color: #009900;">}</span><br />    <span style="color: #009900;">}</span><br />  <span style="color: #009900;">}</span><br /><span style="color: #666666; font-style: italic;">#   colnames(train)[c(th,0)==1]</span><br />  fo=<a href="http://inside-r.org/r-doc/stats/as.formula"><span style="color: #003399; font-weight: bold;">as.formula</span></a><span style="color: #009900;">(</span>fo.str<span style="color: #009900;">)</span><br />  gam1 &lt;- <a href="http://inside-r.org/r-doc/mgcv/gam"><span style="color: #003399; font-weight: bold;">gam</span></a><span style="color: #009900;">(</span>fo<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=train<span style="color: #009900;">)</span><br />  pred1 &lt;- <a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">(</span>gam1<span style="color: #339933;">,</span>valid<span style="color: #339933;">,</span>se=<span style="color: black; font-weight: bold;">FALSE</span><span style="color: #009900;">)</span><br />  sse &lt;- <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">(</span><span style="color: #009900;">(</span>pred1-valid$MEDV<span style="color: #009900;">)</span>^<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span>na.rm=<span style="color: black; font-weight: bold;">TRUE</span><span style="color: #009900;">)</span><br />  <a href="http://inside-r.org/r-doc/base/return"><span style="color: #003399; font-weight: bold;">return</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span>-sse/ssto<span style="color: #009900;">)</span><br /><span style="color: #009900;">}</span><br />&nbsp;<br />res &lt;- tabuSearch<span style="color: #009900;">(</span>size = <a href="http://inside-r.org/r-doc/base/ncol"><span style="color: #003399; font-weight: bold;">ncol</span></a><span style="color: #009900;">(</span>train<span style="color: #009900;">)</span>-<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> iters = <span style="color: #cc66cc;">20</span><span style="color: #339933;">,</span> objFunc = evaluate<span style="color: #339933;">,</span> listSize = <span style="color: #cc66cc;">5</span><span style="color: #339933;">,</span><br />                  config = <a href="http://inside-r.org/r-doc/stats/rbinom"><span style="color: #003399; font-weight: bold;">rbinom</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/ncol"><span style="color: #003399; font-weight: bold;">ncol</span></a><span style="color: #009900;">(</span>train<span style="color: #009900;">)</span>-<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">.5</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> nRestarts = <span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span>verbose=<span style="color: black; font-weight: bold;">TRUE</span><span style="color: #009900;">)</span></pre></div></div><br />It was able to find a subset with a 0.8678 R-squared on the validation set (and 0.8349 on the test set). The formula found was:<br /><span class="Apple-style-span" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: #e1e2e5; border-collapse: separate; color: black; font-family: 'Lucida Console'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15px; orphans: 2; text-align: -webkit-left; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px;"></span><br /><pre class="GDXA2EVBEAB" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'Lucida Console'; font-size: 10pt !important; line-height: 1.2; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0">MEDV ~ s(CRIM) + s(INDUS) + s(NOX) + s(RM) + s(DIS) + RAD + s(TAX) + s(PTRATIO) + s(LSTAT).</pre><br /><br /><h3>Visualizing the results</h3>The tabu search gave me a subset which it thinks is best. But I would like to get a better handle on how it derived it, or if there were lots of models with similar quality, but different variables. Or if there were variables that were always in the top performing models. I created a heat plot that showed whether or not a variable was in the regression or not at each iteration.<br /><br />Below you can see which variables were included in each iteration. There are a few variables that seem to be more important because they are included in almost every iteration, like LSAT, PTRATIO,and RM. But this doesn&#8217;t tell me which iterations were the best.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-h7QkQGRQv7c/UDZm5Lfp40I/AAAAAAAAHKY/EDABwfjZ5R8/s1600/tabu1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-h7QkQGRQv7c/UDZm5Lfp40I/AAAAAAAAHKY/EDABwfjZ5R8/s1600/tabu1.png" /></a></div><br />In the chart below, I shaded each region by the ranking of model in that iteration. The higher ranking mean it did better. It is not easy, but we can glean a little more information from this chart. The models with RAD and DIS do significantly better than the models without them, even though they are not in every iteration. Further, the models with AGE seem a bit worse than those without it.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-TJKQO3ItVkQ/UDZm5o2REyI/AAAAAAAAHKg/UqqyqZ6EELs/s1600/tabu2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-TJKQO3ItVkQ/UDZm5o2REyI/AAAAAAAAHKg/UqqyqZ6EELs/s1600/tabu2.png" /></a></div><br />The R code to make these plots is below.<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/reshape"><span style="color: #003399; font-weight: bold;">reshape</span></a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><span style="color: #339933;">;</span> theme_set<span style="color: #009900;">(</span>theme_bw<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />&nbsp;<br />tabu.df=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>res$configKeep<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>tabu.df<span style="color: #009900;">)</span>=<a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>train<span style="color: #009900;">)</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span>:<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/ncol"><span style="color: #003399; font-weight: bold;">ncol</span></a><span style="color: #009900;">(</span>train<span style="color: #009900;">)</span>-<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span><span style="color: #009900;">]</span><br />tabu.df$Iteration=<span style="color: #cc66cc;">1</span>:<a href="http://inside-r.org/r-doc/base/nrow"><span style="color: #003399; font-weight: bold;">nrow</span></a><span style="color: #009900;">(</span>tabu.df<span style="color: #009900;">)</span><br />tabu.df$RSquared=res$eUtilityKeep<br />tabu.df$Rank=<a href="http://inside-r.org/r-doc/base/rank"><span style="color: #003399; font-weight: bold;">rank</span></a><span style="color: #009900;">(</span>tabu.df$RSquared<span style="color: #009900;">)</span><br />tabu.melt=melt<span style="color: #009900;">(</span>tabu.df<span style="color: #339933;">,</span>id=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">"Iteration"</span><span style="color: #339933;">,</span><span style="color: blue;">"RSquared"</span><span style="color: #339933;">,</span><span style="color: blue;">"Rank"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />tabu.melt$RSquared=<a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">(</span>tabu.melt$value==<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>tabu.melt$RSquared<span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">)</span><br />tabu.melt$Rank=<a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">(</span>tabu.melt$value==<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>tabu.melt$Rank<span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">)</span><br /><span style="color: #009900;">(</span>pHeat01 &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>tabu.melt<span style="color: #339933;">,</span> aes<span style="color: #009900;">(</span>Iteration<span style="color: #339933;">,</span>variable<span style="color: #009900;">)</span><span style="color: #009900;">)</span> + geom_tile<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>fill = value<span style="color: #009900;">)</span><span style="color: #009900;">)</span> +<br />  scale_fill_gradient<span style="color: #009900;">(</span>low = <span style="color: blue;">"white"</span><span style="color: #339933;">,</span> high = <span style="color: blue;">"steelblue"</span><span style="color: #339933;">,</span>guide=<span style="color: black; font-weight: bold;">FALSE</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #009900;">(</span>pHeatRank &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>tabu.melt<span style="color: #339933;">,</span> aes<span style="color: #009900;">(</span>Iteration<span style="color: #339933;">,</span>variable<span style="color: #009900;">)</span><span style="color: #009900;">)</span> + geom_tile<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>fill = Rank<span style="color: #009900;">)</span><span style="color: #009900;">)</span> +<br />  scale_fill_gradient<span style="color: #009900;">(</span>low = <span style="color: blue;">"white"</span><span style="color: #339933;">,</span> high = <span style="color: blue;">"steelblue"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>anonymous</div>
<div class='content'>
Good post!<br /><br />Nice approach with the heat map to go beyond just accepting the optimal solution. I agree that variables seem to be important because they are present in every iteration, but this could perhaps also mean that the tabu search was trapped in a subregion - perhaps the search move operator which only adds or deletes a single variable is not powerful enough to escape this region. Some possible remedies for exploring a larger part of the search landscape (if indeed this is a problem) might be:<br /><br />- Multiple tabu searches, each with a randomized set of initial variables in the model<br />- Other move operators. How about finding correlation clusters among the variables, then let a move add or delete the entire cluster? Both move operators can be used in the search, using some metaheuristics to guide them.<br />- Use metaheuristic techniques like &quot;ruin and recreate&quot; during the tabu search; occasionally, &quot;ruin&quot; the model by removing a random subset of the variables.<br /><br />One more thought. With the tabu search already in place for regression, it wouldn´t be too hard to explore some nonlinear models. You could create temp variables that are products of the original variables, then let the tabu search add or delete these as well. Do you think such an approach would have any merit in this case?<br /></div>
</div>
<div class='comment'>
<div class='author'>Andrew</div>
<div class='content'>
@Anonymous I would also like to see how this does compared to the more standard methods. It will take a little effort to implement in this example, though, because these variable selection techniques are not implemented for GAMs (as far as I know). http://www.statmethods.net/stats/regression.html has a nice summary of different methods available for linear models. You are right that the whole point of using a TS is that it will be better than the other methods, so it would be good to have validation. Maybe I could do a comparison for linear models&#8230;<br /><br />I described the meat of the TS algorithm in the post. If you want more info, I found this reference informative http://www.math.ntua.gr/~fouskakis/Publications/4.pdf </div>
</div>
<div class='comment'>
<div class='author'>Andrew</div>
<div class='content'>
@anspiess That is probably a good idea. But one reason to use Tabu Search is that it will speed up the time to find the best model. Running it many times will defeat this purpose. Running time for the parameters used was long already because GAMs take longer to train than LMs (~ 9 mins). In terms of better understanding TS, your idea would be useful. For what its worth, I ran it again with a different CV split and the chosen model was the same except it added s(ZN) and removed s(PTRATIO).</div>
</div>
<div class='comment'>
<div class='author'>anspiess</div>
<div class='content'>
Might it be feasible to sample training and test set a few hundred times to see how stable variable selection is?</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
I wonder how this method is better than using F test, t test or information criterion? did you compare tabusearch to other methods (for linear models)? maybe it its faster than standard methods? I would be grateful for answers:)  if it its possible maybe you can describe this algorithm more closely.</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/10/a-matrix-factorization-model-for/">A Matrix Factorization Model for Hitter/Pitcher Matchups</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-10T00:00:00-04:00" pubdate data-updated="true">Aug 10<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/10/a-matrix-factorization-model-for/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<h3>Introduction </h3>Matrix factorization has been proven to be one of the best ways to do collaborative filtering. The most common example of collaborative filtering is to predict how much a viewer will like a movie. The power of matrix factorization was a key development of the Netflix Prize (see <a href="http://www2.research.att.com/%7Evolinsky/papers/ieeecomputer.pdf">http://www2.research.att.com/~volinsky/papers/ieeecomputer.pdf</a>).<br /><br />Using the movie rating example, the idea is that there are some underlying features of the movie and underlying attributes of the user that interact to determine if the user will like the movie. So if the user typically likes comedies, and the movie is a comedy, these will interact and the user will like the movie. The best part is that in order to determine these features, we do not need to use any background information on the movie or the user. For example, we don&#8217;t need someone to manually code whether each movie is a comedy or not. Matrix factorization just needs a set of historical ratings, which is usually easily available.<br /><br />Using only a few features, we could probably interpret what each of them mean (comedy, drama, foreign, blockbuster, &#8230;). They found in the Netflix competition that increasing the number of underlying features that make up a user and a movie almost always improved accuracy (they used up to 1500 features). With that many features, they can no longer be interpreted as in the example.<br /><br /><h3>Baseball Data</h3>I find this method interesting, and I wanted to apply it to some real data. One idea I had is predicting whether the result of a pitcher-batter match-up in baseball. Usually in baseball, the analysts cry &#8220;small sample size&#8221; if someone reports that a pitcher is particularly good/bad versus a batter. In order to get an accurate assessment that does not suffer from random variation, we need 100 or more at bats, which usually takes a few years at least.<br /><br />It seems that matrix factorization might be a natural fit, because we are not predicting the specific interaction of the batter/pitcher. Instead, we are estimating some underlying features of the batter and the pitcher. We can estimate these features from all of the match-ups that the batter and pitcher have been in &#8211; not just the ones against each other.<br /><br />One example of a feature that I hoped to extract is batter and pitcher handedness. It is well known that batters fair poorly against pitchers of the same handedness and do better against pitchers of the opposite handedness. Other examples might relate to whether the pitcher can throw fast and how well the batter does against fast pitches; similarly with breaking balls, etc.<br /><br />In the Netflix competition, each user rates movies on a 1 to 5 star scale, and rates the movie only once. The outcome of a match-up is different as there is no obvious &#8220;rating&#8221; of the outcome. I used improvement in expected number of runs scored of the outcome of a plate appearance as the &#8220;rating&#8221; to be predicted (from <a href="http://www.tangotiger.net/RE9902event.html">here</a>). So a single is worth 0.474 runs and an out is worth -0.299 runs. Also, in baseball, there will be many match-ups between the batter and pitcher. I could have averaged the outcomes, but I left the multiple records in the data as is.<br /><br />I used 2010 data and removed all pitchers that were hitting and batters that were pitching. According to my data, there were 65,128 unique batter-pitcher match-ups (with about 173,000 plate appearances). I used 5,000 match-ups as validation, 5,000 as testing, and the remaining as training.<br /><br /><h3>Model Fitting</h3>The first model I used as a baseline just included &#8220;biases&#8221; for the batter and pitcher, as well as an overall league average bias. In the baseline, there are no factors or interactions. So the result of the match-up between a batter i and pitcher j would be estimated as the overall average bias plus the batter i bias plus the pitcher j bias. In math terms:<br /><br /><a href="http://www.codecogs.com/eqnedit.php?latex=%5Cdpi%7B120%7D%20%5Cmu@plus;b_i@plus;p_j" target="_blank"><img src="http://latex.codecogs.com/png.latex?%5Cdpi%7B120%7D%20%5Cmu+b_i+p_j" title="\dpi{120} \mu+b_i+p_j" /></a><br /><br />Higher values for the batter bias mean the batter is better better than average and lower values for the pitcher bias means the pitcher is better than average.<br /><br />So as to not overfit the data, I used L2 regularization on the batter and pitcher biases. For this and future estimation, I used the validation data to determine the best penalty and I used a gradient descent method to solve for the parameters.<br /><br />Adding in the factor interaction, the result of the match-up between a batter i and pitcher j is<br /><br /><a href="http://www.codecogs.com/eqnedit.php?latex=%5Cdpi%7B120%7D%20%5Cmu@plus;b_i@plus;p_j%20@plus;%20%5Cboldsymbol%7Bo%7D_i%5ET%20%5Cboldsymbol%7Bd%7D_j" target="_blank"><img src="http://latex.codecogs.com/png.latex?%5Cdpi%7B120%7D%20%5Cmu+b_i+p_j%20+%20%5Cboldsymbol%7Bo%7D_i%5ET%20%5Cboldsymbol%7Bd%7D_j" title="\dpi{120} \mu+b_i+p_j + \boldsymbol{o}_i^T \boldsymbol{d}_j" /></a><br /><br />where <a href="http://www.codecogs.com/eqnedit.php?latex=%5Cdpi%7B120%7D%20%5Cboldsymbol%7Bo%7D_i" target="_blank"><img src="http://latex.codecogs.com/png.latex?%5Cdpi%7B120%7D%20%5Cboldsymbol%7Bo%7D_i" title="\dpi{120} \boldsymbol{o}_i" /></a> is a vector of offensive features for batter i and <a href="http://www.codecogs.com/eqnedit.php?latex=%5Cdpi%7B120%7D%20%5Cboldsymbol%7Bd%7D_j" target="_blank"><img src="http://latex.codecogs.com/png.latex?%5Cdpi%7B120%7D%20%5Cboldsymbol%7Bd%7D_j" title="\dpi{120} \boldsymbol{d}_j" /></a> is a set of defensive features for pitcher j. The two vectors must be of the same length which we can determine. Again, I used L2 regularization on the feature vectors.<br /><br /><h3>Results</h3>I fit the matrix factorization model using 0, 1, 2, 5, and 10 features. The model with 0 features corresponds to the baseline model. As stated above, I was hoping to see that handedness would show up as one of the first features.<br /><br />I fit the models with the training set, tuned the regularization parameters with the validation set, and finally I am comparing the models with the test set. Unfortunately, the baseline model performed the best of all and the performance degraded as more features were added. A plot of the test mean squared errors is below. The difference between the models is small, but I believe that is because the regularization parameter is shrinking the factor vectors to 0.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-8doS-OZmBzs/UCUmUQWdo_I/AAAAAAAAHKA/CmE1rs9YYOc/s1600/MatFactTestMSE.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-8doS-OZmBzs/UCUmUQWdo_I/AAAAAAAAHKA/CmE1rs9YYOc/s1600/MatFactTestMSE.png" /></a></div>A further baseline model could have been used &#8211; an overall mean with no biases. The MSE for all but the 10-factor  model were better than this average. So the biases help, but unfortunately the factorization did not.<br /><br />I compared the factor vectors of the pitchers by their handedness and I found no difference between righties and lefties.<br /><br /><h3>Summary</h3>The outcome of this analysis was not what I hoped for, but I still learned something about matrix factorization and its implementation. I think the moral of the story is that it is hard to predict batter-pitcher match-ups, probably because there is a lot of variation in every at bat. Matrix factorization has been successfully applied in situations where the data is much more sparse than this application, so this difference may be a reason for its failure. I plan to try this again with the <a href="http://www.libfm.org/">libFM</a> software to see if I get the same results.<br /><br /><i><b>Update:</b></i><br />I implemented this in libFM and basically got the same results, so I guess I was doing it correctly. If I work on this further, I wonder if adding attributes about the pitcher explicitly would help. I would include an indicator for righty/lefty or maybe home/away.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/20/the-magical-sparse-matrix/">The Magical Sparse Matrix</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-20T00:00:00-04:00" pubdate data-updated="true">Jul 20<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/20/the-magical-sparse-matrix/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
I have been toying around with Kaggle&#8217;s <a href="http://www.kaggle.com/c/msdchallenge/">Million Song Dataset Challenge</a> recently because I have some interest in <a href="http://en.wikipedia.org/wiki/Collaborative_filtering">collaborative filtering</a> (using <a href="http://www2.research.att.com/%7Evolinsky/papers/ieeecomputer.pdf" target="_blank">matrix factorization</a>). I haven&#8217;t made much progress with the competition (all 3 of my submissions are below the baseline), but I have learned a few things about dealing with large amounts of data.<br /><br />The goal of the competition is to predict the 500 most likely songs each of 110,000 users will listen to next. As the name implies, there are 1,000,000 songs in the full dataset. To simplify things, I decided to concentrate on the most popular songs. I created a 110,000 x 2,000 matrix of 0&#8217;s and 1&#8217;s. Row i, column j is 1 if user i had listened to song j (the jth most popular song) and 0 if user i had not. As you can imagine, there are a lot more 0&#8217;s than 1&#8217;s in this matrix. The first few rows and columns look like this:<br /><br /><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">0 0 1 0 0 0 1 0 0 1 0 0 1 0 0 0 0 0 0 0 0 0 &#8230;</span></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 &#8230;</span></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">1 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 &#8230;</span></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">&#8230;</span></div><br />This matrix was about 430 Mb and took a while to load into MATLAB. So I wisened up and created a <a href="http://en.wikipedia.org/wiki/Sparse_matrix">sparse matrix</a>. A sparse matrix realizes that most of the values are 0&#8217;s and does not record them. Instead, it lists the locations of the non-zero elements and what the value is. For example, this is what the first few rows of the sparse matrix looks like:<br /><br /><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">1 3 1<br />1 7 1<br />1 10 1<br />1 13 1<br />1 82 1<br />1 717 1<br />2 1111 1<br />2 2972 1<br />2 3516 1</span></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">&#8230;</span></div><br />The first column is the row number, the second is the column number, and the third is the value at that location. In this application, all the values are 1. For this matrix, I used the 50,000 most popular songs (instead of just 2,000), and the size was much smaller &#8211; just 17 Mb.<br /><br />It is easy to load the sparse matrix into MATLAB with the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">spconvert</span> command, and many of MATLAB&#8217;s functions (like singular value decomposition) are optimized for sparse matrices.</div>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/4/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/04/22/yet-another-baseball-defensive-statistic/">Yet Another Baseball Defense Statistic</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/02/hastie-and-tibshirani-interview-jerome-friedman/">Hastie and Tibshirani Interview Jerome Friedman</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/27/top-songs-by-artist-on-cd1025-in-2013/">Top Songs by Artist on CD102.5 in 2013</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/27/when-did-cd1025-book-summerfest-artists/">When Did CD102.5 Book the Summerfest Artists?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/20/downloading-and-analyzing-cd1025s/">Downloading and Analyzing CD1025&#8217;s Playlist</a>
      </li>
    
  </ul>
</section>




<section>
  <h1>Blogroll</h1>
  <p>
  <ul>
	<li><a href="http://www.r-bloggers.com">R-Bloggers</a> </li>
	<li><a href="http://fastml.com/">FastML</a> </li>
	<li><a href="http://blog.kaggle.com/">No Free Hunch (Kaggle)</a> </li>
	<li><a href="http://andrewgelman.com/">Statistical Modeling, Causal Inference, and Social Science</a> </li>
	<li><a href="http://simplystatistics.org/">Simply Statistics</a> </li>
	<li><a href="https://kpq.github.io/chartsnthings/">chartsnthings (NYT Graphics Dept.)</a> </li>
  </ul> 
  </p>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Andrew Landgraf -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'andland';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
